<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>研究模式 - 棒球 OVR 計算器</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .research-header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            margin-bottom: 30px;
        }
        
        .research-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .research-header p {
            font-size: 1.1em;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .research-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .analysis-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 400;
        }
        
        .analysis-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .research-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: white;
        }
        
        .research-button.primary {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
        }
        
        .research-button.secondary {
            background: linear-gradient(135deg, #666, #555);
        }
        
        .research-button.gold {
            background: linear-gradient(135deg, #d4af37, #b8941f);
        }
        
        .research-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 25px;
            text-decoration: none;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .back-link:hover {
            background: white;
            transform: translateY(-2px);
        }
        
        .coming-soon {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border: 2px dashed #90EE90;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: #2d5a2d;
        }
        
        .coming-soon h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .coming-soon p {
            font-size: 1em;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .analysis-buttons {
                flex-direction: column;
            }
            
            .research-button {
                width: 100%;
            }
            
            .research-header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← 返回主頁</a>
    
    <div class="research-header">
        <h1>🔬 研究模式</h1>
        <p>深度數據分析與模型探索工具 - 僅供研究開發使用</p>
    </div>
    
    <div class="research-container">
        <div class="analysis-section">
            <h2>📊 POW 模型分析報告</h2>
            <p style="margin-bottom: 20px; color: #666;">
                固定 HIT 和 EYE 數值，分析 POW 屬性在不同組合下的表現模式。
                用於驗證模型的百分位點數系統和屬性影響階層。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="analyzePOWModel()">
                    🎯 標準分析 (HIT70/EYE70)
                </button>
                <button class="research-button secondary" onclick="analyzePOWModelPR1()">
                    📉 底線分析 (HIT40/EYE40-PR1)
                </button>
                <button class="research-button gold" onclick="analyzePOWModelPR99()">
                    📈 頂線分析 (HIT99/EYE99-PR99)
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>使用說明：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>標準分析：測試 POW 在平均 MLB 技能下的表現</li>
                    <li>底線分析：驗證基本功不足時的長打力上限</li>
                    <li>頂線分析：驗證頂級基本功對長打力的放大效應</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section coming-soon">
            <h3>🚀 未來功能</h3>
            <p>即將新增更多研究工具：屬性相關性分析、歷史數據比對、模型校準工具、統計分佈視覺化等功能</p>
        </div>
    </div>

    <!-- 載入核心 JavaScript 模組 -->
    <script src="constants.js"></script>
    <script src="probability_model.js"></script>
    <script src="simulation_engine.js"></script>
    
    <script>
        // 從主頁面複製 OVR 計算函數
        function calculateBatterOVR(pow, hit, eye) {
            // 簡化版 OVR 計算 - 實際應該從主頁面導入
            const powWeight = 0.35;
            const hitWeight = 0.40;
            const eyeWeight = 0.25;
            
            return Math.round(powWeight * pow + hitWeight * hit + eyeWeight * eye);
        }
        
        // POW分析函數 - 標準版 (HIT=70, EYE=70)
        function analyzePOWModel() {
            console.log("🔬 研究模式：POW模型分析開始 - 標準版 (HIT=70, EYE=70)");
            
            const fixedHIT = 70;
            const fixedEYE = 70;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '🎯 POW模型分析 - 標準版 (HIT=70, EYE=70)');
            return results;
        }

        // POW分析函數 - PR1版 (HIT=40, EYE=40)
        function analyzePOWModelPR1() {
            console.log("🔬 研究模式：POW模型分析開始 - PR1版 (HIT=40, EYE=40)");
            
            const fixedHIT = 40;
            const fixedEYE = 40;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '📉 POW模型分析 - PR1版 (HIT=40, EYE=40)');
            return results;
        }

        // POW分析函數 - PR99版 (HIT=99, EYE=99)
        function analyzePOWModelPR99() {
            console.log("🔬 研究模式：POW模型分析開始 - PR99版 (HIT=99, EYE=99)");
            
            const fixedHIT = 99;
            const fixedEYE = 99;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '📈 POW模型分析 - PR99版 (HIT=99, EYE=99)');
            return results;
        }
        
        // 顯示POW分析結果
        function displayPOWAnalysisResults(results, title) {
            let resultDiv = document.getElementById('powAnalysisResults');
            if (!resultDiv) {
                resultDiv = document.createElement('div');
                resultDiv.id = 'powAnalysisResults';
                resultDiv.style.cssText = `
                    position: fixed;
                    top: 5%;
                    left: 5%;
                    right: 5%;
                    bottom: 5%;
                    background: white;
                    border: 2px solid #333;
                    border-radius: 15px;
                    padding: 25px;
                    overflow: auto;
                    z-index: 3000;
                    font-family: 'Segoe UI', sans-serif;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                `;
                document.body.appendChild(resultDiv);
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                    <h2 style="color: #2c3e50; margin: 0;">${title}</h2>
                    <button onclick="closePOWAnalysis()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500;">關閉報告</button>
                </div>
                <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <tr style="background: #34495e; color: white;">
                        <th style="padding: 10px;">POW</th><th>OVR</th><th>BA</th><th>SLG</th><th>OPS</th><th>HR</th><th>2B</th><th>XBH</th><th>HR/XBH</th><th>BB</th><th>SO</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const powClass = row.POW >= 110 ? 'style="background: #f39c12; color: white;"' : 
                                row.POW >= 99 ? 'style="background: #e67e22; color: white;"' : 
                                row.POW <= 40 ? 'style="background: #bdc3c7;"' : '';
                html += `
                    <tr ${powClass}>
                        <td style="text-align: center; font-weight: bold;">${row.POW}</td>
                        <td style="text-align: center;">${row.OVR}</td>
                        <td style="text-align: center;">${row.BA}</td>
                        <td style="text-align: center;">${row.SLG}</td>
                        <td style="text-align: center;">${row.OPS}</td>
                        <td style="text-align: center; font-weight: bold;">${row.HR}</td>
                        <td style="text-align: center;">${row['2B']}</td>
                        <td style="text-align: center;">${row.XBH}</td>
                        <td style="text-align: center; font-weight: bold;">${row['HR/XBH']}</td>
                        <td style="text-align: center;">${row.BB}</td>
                        <td style="text-align: center;">${row.SO}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            html += '<div style="margin-top: 15px; padding: 10px; background: #ecf0f1; border-radius: 5px; font-size: 11px; color: #7f8c8d;">研究模式數據僅供開發調試使用，不代表最終遊戲表現</div>';
            resultDiv.innerHTML = html;
        }
        
        // 關閉POW分析結果
        function closePOWAnalysis() {
            const resultDiv = document.getElementById('powAnalysisResults');
            if (resultDiv) {
                resultDiv.remove();
            }
        }
    </script>
</body>
</html>