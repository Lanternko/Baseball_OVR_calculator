<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>研究模式 - 棒球 OVR 計算器</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .research-header {
            text-align: center;
            padding: 30px 0;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            margin-bottom: 30px;
        }
        
        .research-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        
        .research-header p {
            font-size: 1.1em;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }
        
        .research-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .analysis-section {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .analysis-section h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.5em;
            font-weight: 400;
        }
        
        .analysis-buttons {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }
        
        .research-button {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            color: white;
        }
        
        .research-button.primary {
            background: linear-gradient(135deg, #ff6b35, #f7931e);
        }
        
        .research-button.secondary {
            background: linear-gradient(135deg, #666, #555);
        }
        
        .research-button.gold {
            background: linear-gradient(135deg, #d4af37, #b8941f);
        }
        
        .research-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        
        .back-link {
            position: fixed;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 10px 15px;
            border-radius: 25px;
            text-decoration: none;
            color: #2c3e50;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .back-link:hover {
            background: white;
            transform: translateY(-2px);
        }
        
        .coming-soon {
            background: linear-gradient(135deg, #e8f5e8, #f0f8f0);
            border: 2px dashed #90EE90;
            border-radius: 15px;
            padding: 30px;
            text-align: center;
            color: #2d5a2d;
        }
        
        .coming-soon h3 {
            margin-bottom: 15px;
            font-size: 1.3em;
        }
        
        .coming-soon p {
            font-size: 1em;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .analysis-buttons {
                flex-direction: column;
            }
            
            .research-button {
                width: 100%;
            }
            
            .research-header h1 {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">← 返回主頁</a>
    
    <div class="research-header">
        <h1>🔬 研究模式</h1>
        <p>深度數據分析與模型探索工具 - 僅供研究開發使用</p>
    </div>
    
    <div class="research-container">
        <div class="analysis-section">
            <h2>📊 POW 模型分析報告</h2>
            <p style="margin-bottom: 20px; color: #666;">
                固定 HIT 和 EYE 數值，分析 POW 屬性在不同組合下的表現模式。
                用於驗證模型的百分位點數系統和屬性影響階層。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="analyzePOWModel()">
                    🎯 標準分析 (HIT70/EYE70)
                </button>
                <button class="research-button secondary" onclick="analyzePOWModelPR1()">
                    📉 底線分析 (HIT40/EYE40-PR1)
                </button>
                <button class="research-button gold" onclick="analyzePOWModelPR99()">
                    📈 頂線分析 (HIT99/EYE99-PR99)
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>使用說明：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>標準分析：測試 POW 在平均 MLB 技能下的表現</li>
                    <li>底線分析：驗證基本功不足時的長打力上限</li>
                    <li>頂線分析：驗證頂級基本功對長打力的放大效應</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>🎯 HIT 模型分析報告</h2>
            <p style="margin-bottom: 20px; color: #666;">
                固定 POW 和 EYE 數值，分析 HIT 屬性在不同組合下的表現模式。
                用於驗證打擊率(BA)基準值和接觸技術影響階層。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="analyzeHITModel()">
                    🎯 標準分析 (POW70/EYE70)
                </button>
                <button class="research-button secondary" onclick="analyzeHITModelPR1()">
                    📉 底線分析 (POW40/EYE40-PR1)
                </button>
                <button class="research-button gold" onclick="analyzeHITModelPR99()">
                    📈 頂線分析 (POW99/EYE99-PR99)
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>使用說明：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>標準分析：測試 HIT 在平均 MLB 技能下的 BA 表現</li>
                    <li>底線分析：驗證基本長打力和選球下的接觸能力</li>
                    <li>頂線分析：驗證頂級環境下的接觸技術效果</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>👁️ EYE 模型分析報告</h2>
            <p style="margin-bottom: 20px; color: #666;">
                固定 POW 和 HIT 數值，分析 EYE 屬性在不同組合下的表現模式。
                用於驗證上壘率(OBP)基準值和選球眼影響階層。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="analyzeEYEModel()">
                    👁️ 標準分析 (POW70/HIT70)
                </button>
                <button class="research-button secondary" onclick="analyzeEYEModelPR1()">
                    📉 底線分析 (POW40/HIT40-PR1)
                </button>
                <button class="research-button gold" onclick="analyzeEYEModelPR99()">
                    📈 頂線分析 (POW99/HIT99-PR99)
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>使用說明：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>標準分析：測試 EYE 在平均 MLB 技能下的 OBP 表現</li>
                    <li>底線分析：驗證基本技能下的選球眼效果</li>
                    <li>頂線分析：驗證頂級技能環境下的選球能力放大</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>🔄 雙向轉換準確性測試</h2>
            <p style="margin-bottom: 20px; color: #666;">
                測試屬性↔數據雙向轉換的準確性，驗證各種屬性組合(40/70/99)的轉換一致性。
                這是確保整個模型基礎穩定性的關鍵測試。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="window.open('bidirectional_fixed.html', '_blank')">
                    🔄 雙向轉換測試 (修復版)
                </button>
                <button class="research-button secondary" onclick="window.open('test_debug.html', '_blank')">
                    🔧 模組載入調試
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>測試內容：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>全40/70/99標準屬性組合</li>
                    <li>混合屬性組合(如40/70/99)</li>
                    <li>全明星/MVP等級測試</li>
                    <li>完整系統準確性評估</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section">
            <h2>🎯 大谷翔平2024校準分析</h2>
            <p style="margin-bottom: 20px; color: #666;">
                基於大谷翔平2024真實數據(.310/.390/.646)進行模型校準分析，
                檢驗v2.2版本的基準值和BABIP曲線調整效果。
            </p>
            
            <div class="analysis-buttons">
                <button class="research-button primary" onclick="window.open('ohtani_simple.html', '_blank')">
                    🔬 大谷校準分析
                </button>
            </div>
            
            <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 13px; color: #666;">
                <strong>分析內容：</strong>
                <ul style="margin: 5px 0 0 20px;">
                    <li>轉換公式準確性測試</li>
                    <li>基準值調整效果對比</li>
                    <li>BABIP曲線校準驗證</li>
                    <li>整體校準效果評估</li>
                </ul>
            </div>
        </div>
        
        <div class="analysis-section coming-soon">
            <h3>🚀 未來功能</h3>
            <p>即將新增更多研究工具：屬性相關性分析、歷史數據比對、模型校準工具、統計分佈視覺化等功能</p>
        </div>
    </div>

    <!-- 載入核心 JavaScript 模組 -->
    <script src="constants.js"></script>
    <script src="probability_model.js"></script>
    <script src="simulation_engine.js"></script>
    
    <script>
        // 從主頁面複製 OVR 計算函數
        function calculateBatterOVR(pow, hit, eye) {
            // 簡化版 OVR 計算 - 實際應該從主頁面導入
            const powWeight = 0.35;
            const hitWeight = 0.40;
            const eyeWeight = 0.25;
            
            return Math.round(powWeight * pow + hitWeight * hit + eyeWeight * eye);
        }
        
        // POW分析函數 - 標準版 (HIT=70, EYE=70)
        function analyzePOWModel() {
            console.log("🔬 研究模式：POW模型分析開始 - 標準版 (HIT=70, EYE=70)");
            
            const fixedHIT = 70;
            const fixedEYE = 70;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '🎯 POW模型分析 - 標準版 (HIT=70, EYE=70)');
            return results;
        }

        // POW分析函數 - PR1版 (HIT=40, EYE=40)
        function analyzePOWModelPR1() {
            console.log("🔬 研究模式：POW模型分析開始 - PR1版 (HIT=40, EYE=40)");
            
            const fixedHIT = 40;
            const fixedEYE = 40;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '📉 POW模型分析 - PR1版 (HIT=40, EYE=40)');
            return results;
        }

        // POW分析函數 - PR99版 (HIT=99, EYE=99)
        function analyzePOWModelPR99() {
            console.log("🔬 研究模式：POW模型分析開始 - PR99版 (HIT=99, EYE=99)");
            
            const fixedHIT = 99;
            const fixedEYE = 99;
            const results = [];
            
            for (let pow = 40; pow <= 150; pow += 5) {
                const stats = simulatePlayerStats(pow, fixedHIT, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(pow, fixedHIT, fixedEYE);
                
                results.push({
                    POW: pow,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3),
                    OPS: stats.OPS.toFixed(3),
                    HR: Math.round(stats.HR_count || 0),
                    '2B': Math.round(stats.doubles_count || 0),
                    'XBH': Math.round((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0)),
                    'HR/XBH': stats.HR_count && (stats.doubles_count || stats.triples_count) ? 
                        ((stats.HR_count / ((stats.HR_count || 0) + (stats.doubles_count || 0) + (stats.triples_count || 0))) * 100).toFixed(1) + '%' : 
                        '100.0%',
                    BB: Math.round(stats.BB_rate * 600),
                    SO: Math.round(stats.K_rate * 600)
                });
            }
            
            console.table(results);
            displayPOWAnalysisResults(results, '📈 POW模型分析 - PR99版 (HIT=99, EYE=99)');
            return results;
        }
        
        // 顯示POW分析結果
        function displayPOWAnalysisResults(results, title) {
            let resultDiv = document.getElementById('powAnalysisResults');
            if (!resultDiv) {
                resultDiv = document.createElement('div');
                resultDiv.id = 'powAnalysisResults';
                resultDiv.style.cssText = `
                    position: fixed;
                    top: 5%;
                    left: 5%;
                    right: 5%;
                    bottom: 5%;
                    background: white;
                    border: 2px solid #333;
                    border-radius: 15px;
                    padding: 25px;
                    overflow: auto;
                    z-index: 3000;
                    font-family: 'Segoe UI', sans-serif;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                `;
                document.body.appendChild(resultDiv);
            }
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                    <h2 style="color: #2c3e50; margin: 0;">${title}</h2>
                    <button onclick="closePOWAnalysis()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500;">關閉報告</button>
                </div>
                <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <tr style="background: #34495e; color: white;">
                        <th style="padding: 10px;">POW</th><th>OVR</th><th>BA</th><th>SLG</th><th>OPS</th><th>HR</th><th>2B</th><th>XBH</th><th>HR/XBH</th><th>BB</th><th>SO</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const powClass = row.POW >= 110 ? 'style="background: #f39c12; color: white;"' : 
                                row.POW >= 99 ? 'style="background: #e67e22; color: white;"' : 
                                row.POW <= 40 ? 'style="background: #bdc3c7;"' : '';
                html += `
                    <tr ${powClass}>
                        <td style="text-align: center; font-weight: bold;">${row.POW}</td>
                        <td style="text-align: center;">${row.OVR}</td>
                        <td style="text-align: center;">${row.BA}</td>
                        <td style="text-align: center;">${row.SLG}</td>
                        <td style="text-align: center;">${row.OPS}</td>
                        <td style="text-align: center; font-weight: bold;">${row.HR}</td>
                        <td style="text-align: center;">${row['2B']}</td>
                        <td style="text-align: center;">${row.XBH}</td>
                        <td style="text-align: center; font-weight: bold;">${row['HR/XBH']}</td>
                        <td style="text-align: center;">${row.BB}</td>
                        <td style="text-align: center;">${row.SO}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            html += '<div style="margin-top: 15px; padding: 10px; background: #ecf0f1; border-radius: 5px; font-size: 11px; color: #7f8c8d;">研究模式數據僅供開發調試使用，不代表最終遊戲表現</div>';
            resultDiv.innerHTML = html;
        }
        
        // 關閉POW分析結果
        function closePOWAnalysis() {
            const resultDiv = document.getElementById('powAnalysisResults');
            if (resultDiv) {
                resultDiv.remove();
            }
        }

        // HIT分析函數 - 標準版 (POW=70, EYE=70)
        function analyzeHITModel() {
            console.log("🎯 研究模式：HIT模型分析開始 - 標準版 (POW=70, EYE=70)");
            
            const fixedPOW = 70;
            const fixedEYE = 70;
            const results = [];
            
            for (let hit = 40; hit <= 150; hit += 5) {
                const stats = simulatePlayerStats(fixedPOW, hit, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, hit, fixedEYE);
                
                results.push({
                    HIT: hit,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    BABIP: (stats.BABIP || 0).toFixed(3),
                    OBP: stats.OBP.toFixed(3),
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    '安打': Math.round(stats.H_count || 0),
                    '三振': Math.round(stats.K_count || 0),
                    '保送': Math.round(stats.BB_count || 0)
                });
            }
            
            console.table(results);
            displayHITAnalysisResults(results, '🎯 HIT模型分析 - 標準版 (POW=70, EYE=70)');
            return results;
        }

        // HIT分析函數 - PR1版 (POW=40, EYE=40)
        function analyzeHITModelPR1() {
            console.log("🎯 研究模式：HIT模型分析開始 - PR1版 (POW=40, EYE=40)");
            
            const fixedPOW = 40;
            const fixedEYE = 40;
            const results = [];
            
            for (let hit = 40; hit <= 150; hit += 5) {
                const stats = simulatePlayerStats(fixedPOW, hit, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, hit, fixedEYE);
                
                results.push({
                    HIT: hit,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    BABIP: (stats.BABIP || 0).toFixed(3),
                    OBP: stats.OBP.toFixed(3),
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    '安打': Math.round(stats.H_count || 0),
                    '三振': Math.round(stats.K_count || 0),
                    '保送': Math.round(stats.BB_count || 0)
                });
            }
            
            console.table(results);
            displayHITAnalysisResults(results, '📉 HIT模型分析 - PR1版 (POW=40, EYE=40)');
            return results;
        }

        // HIT分析函數 - PR99版 (POW=99, EYE=99)
        function analyzeHITModelPR99() {
            console.log("🎯 研究模式：HIT模型分析開始 - PR99版 (POW=99, EYE=99)");
            
            const fixedPOW = 99;
            const fixedEYE = 99;
            const results = [];
            
            for (let hit = 40; hit <= 150; hit += 5) {
                const stats = simulatePlayerStats(fixedPOW, hit, fixedEYE, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, hit, fixedEYE);
                
                results.push({
                    HIT: hit,
                    OVR: Math.round(ovr),
                    BA: stats.BA.toFixed(3),
                    BABIP: (stats.BABIP || 0).toFixed(3),
                    OBP: stats.OBP.toFixed(3),
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    '安打': Math.round(stats.H_count || 0),
                    '三振': Math.round(stats.K_count || 0),
                    '保送': Math.round(stats.BB_count || 0)
                });
            }
            
            console.table(results);
            displayHITAnalysisResults(results, '📈 HIT模型分析 - PR99版 (POW=99, EYE=99)');
            return results;
        }

        // EYE分析函數 - 標準版 (POW=70, HIT=70)
        function analyzeEYEModel() {
            console.log("👁️ 研究模式：EYE模型分析開始 - 標準版 (POW=70, HIT=70)");
            
            const fixedPOW = 70;
            const fixedHIT = 70;
            const results = [];
            
            for (let eye = 40; eye <= 150; eye += 5) {
                const stats = simulatePlayerStats(fixedPOW, fixedHIT, eye, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, fixedHIT, eye);
                const bbCount = Math.round(stats.BB_count || 0);
                const kCount = Math.round(stats.K_count || 0);
                
                results.push({
                    EYE: eye,
                    OVR: Math.round(ovr),
                    OBP: stats.OBP.toFixed(3),
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB/K': bbCount > 0 && kCount > 0 ? (bbCount/kCount).toFixed(2) : '0.00',
                    '保送': bbCount,
                    '三振': kCount,
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3)
                });
            }
            
            console.table(results);
            displayEYEAnalysisResults(results, '👁️ EYE模型分析 - 標準版 (POW=70, HIT=70)');
            return results;
        }

        // EYE分析函數 - PR1版 (POW=40, HIT=40)
        function analyzeEYEModelPR1() {
            console.log("👁️ 研究模式：EYE模型分析開始 - PR1版 (POW=40, HIT=40)");
            
            const fixedPOW = 40;
            const fixedHIT = 40;
            const results = [];
            
            for (let eye = 40; eye <= 150; eye += 5) {
                const stats = simulatePlayerStats(fixedPOW, fixedHIT, eye, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, fixedHIT, eye);
                const bbCount = Math.round(stats.BB_count || 0);
                const kCount = Math.round(stats.K_count || 0);
                
                results.push({
                    EYE: eye,
                    OVR: Math.round(ovr),
                    OBP: stats.OBP.toFixed(3),
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB/K': bbCount > 0 && kCount > 0 ? (bbCount/kCount).toFixed(2) : '0.00',
                    '保送': bbCount,
                    '三振': kCount,
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3)
                });
            }
            
            console.table(results);
            displayEYEAnalysisResults(results, '📉 EYE模型分析 - PR1版 (POW=40, HIT=40)');
            return results;
        }

        // EYE分析函數 - PR99版 (POW=99, HIT=99)
        function analyzeEYEModelPR99() {
            console.log("👁️ 研究模式：EYE模型分析開始 - PR99版 (POW=99, HIT=99)");
            
            const fixedPOW = 99;
            const fixedHIT = 99;
            const results = [];
            
            for (let eye = 40; eye <= 150; eye += 5) {
                const stats = simulatePlayerStats(fixedPOW, fixedHIT, eye, 1000, 600);
                const ovr = calculateBatterOVR(fixedPOW, fixedHIT, eye);
                const bbCount = Math.round(stats.BB_count || 0);
                const kCount = Math.round(stats.K_count || 0);
                
                results.push({
                    EYE: eye,
                    OVR: Math.round(ovr),
                    OBP: stats.OBP.toFixed(3),
                    'BB%': (stats.BB_rate * 100).toFixed(1) + '%',
                    'K%': (stats.K_rate * 100).toFixed(1) + '%',
                    'BB/K': bbCount > 0 && kCount > 0 ? (bbCount/kCount).toFixed(2) : '0.00',
                    '保送': bbCount,
                    '三振': kCount,
                    BA: stats.BA.toFixed(3),
                    SLG: stats.SLG.toFixed(3)
                });
            }
            
            console.table(results);
            displayEYEAnalysisResults(results, '📈 EYE模型分析 - PR99版 (POW=99, HIT=99)');
            return results;
        }

        // 顯示HIT分析結果
        function displayHITAnalysisResults(results, title) {
            const existingDiv = document.getElementById('hitAnalysisResults');
            if (existingDiv) {
                existingDiv.remove();
            }
            
            const resultDiv = document.createElement('div');
            resultDiv.id = 'hitAnalysisResults';
            resultDiv.style.cssText = `
                position: fixed;
                top: 5%;
                left: 5%;
                right: 5%;
                bottom: 5%;
                background: white;
                border: 2px solid #27ae60;
                border-radius: 15px;
                padding: 25px;
                overflow: auto;
                z-index: 3000;
                font-family: 'Segoe UI', sans-serif;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(resultDiv);
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                    <h2 style="color: #27ae60; margin: 0;">${title}</h2>
                    <button onclick="closeHITAnalysis()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500;">關閉報告</button>
                </div>
                <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <tr style="background: #34495e; color: white;">
                        <th style="padding: 10px;">HIT</th><th>OVR</th><th>BA</th><th>BABIP</th><th>OBP</th><th>K%</th><th>BB%</th><th>安打</th><th>三振</th><th>保送</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const hitClass = (row.HIT === 40 || row.HIT === 70 || row.HIT === 99) ? 
                    'style="background: #f39c12; font-weight: bold;"' : '';
                html += `
                    <tr ${hitClass}>
                        <td style="text-align: center; font-weight: bold; padding: 8px;">${row.HIT}</td>
                        <td style="text-align: center; padding: 8px;">${row.OVR}</td>
                        <td style="text-align: center; padding: 8px;">${row.BA}</td>
                        <td style="text-align: center; padding: 8px;">${row.BABIP}</td>
                        <td style="text-align: center; padding: 8px;">${row.OBP}</td>
                        <td style="text-align: center; padding: 8px;">${row['K%']}</td>
                        <td style="text-align: center; padding: 8px;">${row['BB%']}</td>
                        <td style="text-align: center; padding: 8px;">${row['安打']}</td>
                        <td style="text-align: center; padding: 8px;">${row['三振']}</td>
                        <td style="text-align: center; padding: 8px;">${row['保送']}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            html += '<div style="margin-top: 15px; padding: 10px; background: #ecf0f1; border-radius: 5px; font-size: 11px; color: #7f8c8d;">研究模式數據僅供開發調試使用，不代表最終遊戲表現</div>';
            resultDiv.innerHTML = html;
        }

        // 顯示EYE分析結果
        function displayEYEAnalysisResults(results, title) {
            const existingDiv = document.getElementById('eyeAnalysisResults');
            if (existingDiv) {
                existingDiv.remove();
            }
            
            const resultDiv = document.createElement('div');
            resultDiv.id = 'eyeAnalysisResults';
            resultDiv.style.cssText = `
                position: fixed;
                top: 5%;
                left: 5%;
                right: 5%;
                bottom: 5%;
                background: white;
                border: 2px solid #9b59b6;
                border-radius: 15px;
                padding: 25px;
                overflow: auto;
                z-index: 3000;
                font-family: 'Segoe UI', sans-serif;
                box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(resultDiv);
            
            let html = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 2px solid #eee; padding-bottom: 15px;">
                    <h2 style="color: #9b59b6; margin: 0;">${title}</h2>
                    <button onclick="closeEYEAnalysis()" style="background: #e74c3c; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 500;">關閉報告</button>
                </div>
                <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse; font-size: 12px;">
                    <tr style="background: #34495e; color: white;">
                        <th style="padding: 10px;">EYE</th><th>OVR</th><th>OBP</th><th>BB%</th><th>K%</th><th>BB/K</th><th>保送</th><th>三振</th><th>BA</th><th>SLG</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const eyeClass = (row.EYE === 40 || row.EYE === 70 || row.EYE === 99) ? 
                    'style="background: #f39c12; font-weight: bold;"' : '';
                html += `
                    <tr ${eyeClass}>
                        <td style="text-align: center; font-weight: bold; padding: 8px;">${row.EYE}</td>
                        <td style="text-align: center; padding: 8px;">${row.OVR}</td>
                        <td style="text-align: center; padding: 8px;">${row.OBP}</td>
                        <td style="text-align: center; padding: 8px;">${row['BB%']}</td>
                        <td style="text-align: center; padding: 8px;">${row['K%']}</td>
                        <td style="text-align: center; padding: 8px;">${row['BB/K']}</td>
                        <td style="text-align: center; padding: 8px;">${row['保送']}</td>
                        <td style="text-align: center; padding: 8px;">${row['三振']}</td>
                        <td style="text-align: center; padding: 8px;">${row.BA}</td>
                        <td style="text-align: center; padding: 8px;">${row.SLG}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            html += '<div style="margin-top: 15px; padding: 10px; background: #ecf0f1; border-radius: 5px; font-size: 11px; color: #7f8c8d;">研究模式數據僅供開發調試使用，不代表最終遊戲表現</div>';
            resultDiv.innerHTML = html;
        }

        // 關閉HIT分析結果
        function closeHITAnalysis() {
            const resultDiv = document.getElementById('hitAnalysisResults');
            if (resultDiv) {
                resultDiv.remove();
            }
        }

        // 關閉EYE分析結果
        function closeEYEAnalysis() {
            const resultDiv = document.getElementById('eyeAnalysisResults');
            if (resultDiv) {
                resultDiv.remove();
            }
        }
    </script>
</body>
</html>