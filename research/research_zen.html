<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç ”ç©¶æ¨¡å¼ - æ£’çƒ OVR è¨ˆç®—å™¨</title>
    <link rel="stylesheet" href="../src/css/style.css">
    <link rel="stylesheet" href="../src/css/player-cards.css">
    <link rel="stylesheet" href="../src/css/modal.css">
    <style>
        /* ================================== */
        /* ç ”ç©¶æ¨¡å¼æ“´å±•æ¨£å¼ */
        /* ================================== */
        
        /* é é¢ä½ˆå±€ */
        .research-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: var(--spacing-xl);
        }
        
        /* æ¸¬è©¦å€å¡Š */
        .test-section {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            margin: var(--spacing-2xl) 0;
            overflow: hidden;
            border: 1px solid #E5E5E5;
        }
        
        .test-section-header {
            background: var(--bg-surface);
            border-bottom: 1px solid #E5E5E5;
            padding: var(--spacing-lg);
        }
        
        .test-section-header h2 {
            margin: 0 0 var(--spacing-sm) 0;
            color: var(--text-primary);
            font-size: 1.3em;
            font-weight: 600;
        }
        
        .test-section-header p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.9em;
        }
        
        .test-section-content {
            padding: var(--spacing-xl);
        }
        
        /* æ§åˆ¶é¢æ¿ */
        .control-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: var(--spacing-lg);
            margin-bottom: var(--spacing-2xl);
        }
        
        .control-group {
            background: var(--bg-card);
            border: 1px solid #E5E5E5;
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
        }
        
        .control-group h3 {
            margin: 0 0 var(--spacing-md) 0;
            color: var(--text-primary);
            font-size: 1em;
            font-weight: 600;
        }
        
        /* å±¬æ€§é¸æ“‡å™¨ */
        .attribute-selector {
            display: flex;
            gap: var(--spacing-sm);
            flex-wrap: wrap;
        }
        
        .attribute-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 2px solid #E5E5E5;
            background: var(--bg-surface);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s ease;
            flex: 1;
            min-width: 80px;
            text-align: center;
        }
        
        .attribute-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
        }
        
        .attribute-btn.active {
            background: var(--accent-primary);
            color: white;
            border-color: var(--accent-primary);
        }
        
        /* å¿«é€Ÿæ¸¬è©¦æŒ‰éˆ• */
        .quick-test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: var(--spacing-md);
        }
        
        .quick-test-btn {
            padding: var(--spacing-md);
            background: var(--bg-surface);
            border: 1px solid #E5E5E5;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
        }
        
        .quick-test-btn:hover {
            border-color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        .quick-test-btn h4 {
            margin: 0 0 var(--spacing-xs) 0;
            color: var(--text-primary);
            font-size: 0.9em;
            font-weight: 600;
        }
        
        .quick-test-btn p {
            margin: 0;
            color: var(--text-secondary);
            font-size: 0.8em;
        }
        
        /* çµæœé¡¯ç¤º */
        .results-container {
            background: var(--bg-surface);
            border: 1px solid #E5E5E5;
            border-radius: var(--radius-md);
            padding: var(--spacing-lg);
            margin-top: var(--spacing-lg);
        }
        
        .results-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.85em;
        }
        
        .results-table th,
        .results-table td {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid #E5E5E5;
            text-align: center;
        }
        
        .results-table th {
            background: var(--bg-header);
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .results-table tbody tr:nth-child(even) {
            background: #FAFAFA;
        }
        
        .results-table tbody tr:hover {
            background: var(--accent-light);
        }
        
        /* ç‹€æ…‹æŒ‡ç¤ºå™¨ */
        .status-indicator {
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
            font-size: 0.8em;
            font-weight: 500;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }
        
        .status-excellent .status-dot { background: var(--success); }
        .status-good .status-dot { background: var(--info); }
        .status-fair .status-dot { background: var(--warning); }
        .status-poor .status-dot { background: var(--error); }
        
        /* è¼‰å…¥ç‹€æ…‹ */
        .loading-indicator {
            text-align: center;
            padding: var(--spacing-3xl);
            color: var(--text-secondary);
        }
        
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid var(--accent-light);
            border-radius: 50%;
            border-top: 2px solid var(--accent-primary);
            animation: spin 1s linear infinite;
            margin-right: var(--spacing-sm);
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ */
        @media (max-width: 768px) {
            .research-container {
                padding: var(--spacing-md);
            }
            
            .control-panel {
                grid-template-columns: 1fr;
            }
            
            .attribute-selector {
                flex-direction: column;
            }
            
            .quick-test-grid {
                grid-template-columns: 1fr;
            }
            
            .results-table {
                font-size: 0.75em;
            }
        }
        
        /* é«˜äº®è¡Œ */
        .highlight-row {
            background: var(--accent-light) !important;
            border: 2px solid var(--accent-primary) !important;
        }
        
        .highlight-row td {
            font-weight: 600;
            color: var(--accent-secondary);
        }
        
        /* ä¸»é æŒ‰éˆ• */
        .header-btn {
            padding: var(--spacing-sm) var(--spacing-md);
            border: 1px solid #E5E5E5;
            background: var(--bg-surface);
            color: var(--text-secondary);
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 500;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
            margin-right: var(--spacing-sm);
        }
        
        .header-btn:hover {
            border-color: var(--accent-primary);
            color: var(--accent-primary);
            background: var(--accent-light);
        }
        
        /* ä¸»é åœ–æ¨™æ¨£å¼ */
        .home-btn {
            background: transparent;
            border: none;
            padding: var(--spacing-sm);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            transition: all 0.2s ease;
        }
        
        .home-btn:hover {
            background: rgba(128, 128, 128, 0.1);
            transform: scale(1.1);
        }
        
        .home-btn:active {
            transform: scale(0.95);
        }
        
        .home-icon {
            width: 20px;
            height: 20px;
            opacity: 0.7;
            transition: opacity 0.2s ease;
        }
        
        .home-btn:hover .home-icon {
            opacity: 1;
        }
        
        /* æ·±è‰²æ¨¡å¼ä¸‹çš„åœ–æ¨™è™•ç† */
        [data-theme="dark"] .home-icon {
            filter: invert(1);
        }
        
        /* ç§»é™¤ç ”ç©¶æ¨¡å¼ä¸­çš„æ¨™ç±¤åˆ†éš”ç·š */
        .tab-buttons::after {
            display: none;
        }
        
    </style>
</head>
<body>
    <!-- ä½¿ç”¨ä¸»é é¢ç›¸åŒçš„é ­éƒ¨è¨­è¨ˆ -->
    <div class="header">
        <div class="header-content">
            <h1 class="full-title">ç ”ç©¶æ¨¡å¼</h1>
            <h1 class="mobile-title">ç ”ç©¶æ¨¡å¼</h1>
            <p>æ·±åº¦æ•¸æ“šåˆ†æèˆ‡æ¨¡å‹æ¢ç´¢å·¥å…·</p>
            <div class="header-buttons">
                <button class="header-btn home-btn" onclick="goToMainPage()" title="è¿”å›ä¸»é ">
                    <img src="../src/icons/home.png" alt="è¿”å›ä¸»é " class="home-icon">
                </button>
                <button class="theme-toggle" id="themeToggle" onclick="toggleTheme()" title="åˆ‡æ›æ·±æ·ºæ¨¡å¼">
                    â—
                </button>
            </div>
            <div class="tab-buttons">
                <button class="tab-btn active" id="tabAnalysis" onclick="switchTab('analysis')">
                    å±¬æ€§åˆ†æ
                </button>
                <button class="tab-btn" id="tabValidation" onclick="switchTab('validation')">
                    æ¨¡å‹é©—è­‰
                </button>
                <button class="tab-btn" id="tabIsolation" onclick="switchTab('isolation')">
                    å±¬æ€§éš”é›¢
                </button>
                <button class="tab-btn" id="tabComparison" onclick="switchTab('comparison')">
                    çœŸå¯¦å°æ¯”
                </button>
            </div>
        </div>
    </div>

    <div class="research-container">
        <!-- å±¬æ€§åˆ†ææ¨™ç±¤ -->
        <div id="analysis" class="tab-content active">
            <!-- å¿«é€Ÿæ¸¬è©¦é¢æ¿ -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>â­ æ ¸å¿ƒçµ±è¨ˆæ¸¬è©¦</h2>
                    <p>æ¸¬è©¦é—œéµç­‰ç´š (40/70/100/120/150) çµ±è¨ˆæº–ç¢ºæ€§ - é«˜ç²¾åº¦æ¨¡æ“¬</p>
                </div>
                <div class="test-section-content">
                    <div class="quick-test-grid">
                        <div class="quick-test-btn" onclick="runEssentialTest()">
                            <h4>ğŸ¯ æ ¸å¿ƒç­‰ç´šæ¸¬è©¦</h4>
                            <p>é©—è­‰ 5 å€‹é—œéµèƒ½åŠ›ç­‰ç´šçš„çµ±è¨ˆæº–ç¢ºæ€§</p>
                        </div>
                        <div class="quick-test-btn" onclick="runPerformanceTest()">
                            <h4>âš¡ æ€§èƒ½åŸºæº–æ¸¬è©¦</h4>
                            <p>è©•ä¼°æ¨¡å‹åŸ·è¡Œé€Ÿåº¦å’Œç©©å®šæ€§</p>
                        </div>
                        <div class="quick-test-btn" onclick="runRangeValidationTest()">
                            <h4>ğŸ“Š ç¯„åœé©—è­‰æ¸¬è©¦</h4>
                            <p>ç¢ºèªçµ±è¨ˆæ•¸æ“šåœ¨åˆç†ç¯„åœå…§</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
            <div id="analysisResults"></div>
        </div>

        <!-- å±¬æ€§éš”é›¢æ¨™ç±¤ -->
        <div id="isolation" class="tab-content" style="display: none;">
            <!-- å±¬æ€§åˆ†ææ§åˆ¶å° -->
            <div class="test-section">
                <div class="test-section-header">
                    <h2>ğŸ” å±¬æ€§éš”é›¢åˆ†æ</h2>
                    <p>é¸æ“‡å–®ä¸€å±¬æ€§é€²è¡Œæ·±åº¦åˆ†æï¼Œå…¶ä»–å±¬æ€§ä¿æŒå›ºå®šï¼Œè§€å¯Ÿè©²å±¬æ€§å°çµ±è¨ˆæ•¸æ“šçš„ç¨ç«‹å½±éŸ¿</p>
                </div>
                <div class="test-section-content">
                    <div class="control-panel">
                        <div class="control-group">
                            <h3>å±¬æ€§é¸æ“‡</h3>
                            <div class="attribute-selector">
                                <button class="attribute-btn active" data-attr="pow" onclick="selectAttribute('pow')">
                                    ğŸ’ª POW
                                </button>
                                <button class="attribute-btn" data-attr="hit" onclick="selectAttribute('hit')">
                                    ğŸ¯ HIT
                                </button>
                                <button class="attribute-btn" data-attr="eye" onclick="selectAttribute('eye')">
                                    ğŸ‘ï¸ EYE
                                </button>
                            </div>
                        </div>
                        <div class="control-group">
                            <h3>æ¸¬è©¦ç’°å¢ƒ</h3>
                            <div class="attribute-selector">
                                <button class="attribute-btn" onclick="runAttributeAnalysis('bottom')">
                                    åº•ç·š (40/40)
                                </button>
                                <button class="attribute-btn active" onclick="runAttributeAnalysis('standard')">
                                    æ¨™æº– (70/70)
                                </button>
                                <button class="attribute-btn" onclick="runAttributeAnalysis('elite')">
                                    é ‚ç·š (100/100)
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- çµæœé¡¯ç¤ºå€åŸŸ -->
            <div id="isolationResults"></div>
        </div>

        <!-- æ¨¡å‹é©—è­‰æ¨™ç±¤ -->
        <div id="validation" class="tab-content" style="display: none;">
            <div class="test-section">
                <div class="test-section-header">
                    <h2>ğŸ”„ é›™å‘è½‰æ›é©—è­‰</h2>
                    <p>é©—è­‰å±¬æ€§èˆ‡æ•¸æ“šé–“çš„é›™å‘è½‰æ›æº–ç¢ºæ€§</p>
                </div>
                <div class="test-section-content">
                    <div class="quick-test-grid">
                        <div class="quick-test-btn" onclick="runPrecisionTest()">
                            <h4>ğŸ¯ ç²¾ç¢ºåº¦æ¸¬è©¦</h4>
                            <p>é©—è­‰ 100/100/100 çµ„åˆç²¾ç¢ºæ€§</p>
                        </div>
                        <div class="quick-test-btn" onclick="runBalanceTest()">
                            <h4>âš–ï¸ å¹³è¡¡æ€§æª¢æŸ¥</h4>
                            <p>æª¢æŸ¥æ¥µç«¯æ•¸å€¼ä¸‹çš„ç©©å®šæ€§</p>
                        </div>
                        <div class="quick-test-btn" onclick="runConsistencyTest()">
                            <h4>ğŸ”„ ä¸€è‡´æ€§æ¸¬è©¦</h4>
                            <p>æ¸¬è©¦å¤šæ¬¡é‹è¡Œçµæœçš„ç©©å®šæ€§</p>
                        </div>
                        <div class="quick-test-btn" onclick="runBidirectionalTest()">
                            <h4>â†”ï¸ é›™å‘è½‰æ›æ¸¬è©¦</h4>
                            <p>å®Œæ•´çš„å±¬æ€§â†”æ•¸æ“šè½‰æ›æ¸¬è©¦</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- é©—è­‰çµæœé¡¯ç¤º -->
            <div id="validationResults"></div>
        </div>

        <!-- çœŸå¯¦å°æ¯”æ¨™ç±¤ -->
        <div id="comparison" class="tab-content" style="display: none;">
            <div class="test-section">
                <div class="test-section-header">
                    <h2>ğŸŒŸ çœŸå¯¦çƒå“¡å°æ¯”</h2>
                    <p>å°‡æ¨¡å‹é æ¸¬èˆ‡çœŸå¯¦ MLB çƒå“¡æ•¸æ“šé€²è¡Œå°æ¯”åˆ†æ</p>
                </div>
                <div class="test-section-content">
                    <div class="quick-test-grid">
                        <div class="quick-test-btn" onclick="runRealPlayerTest('judge2024')">
                            <h4>âš¾ Aaron Judge 2024</h4>
                            <p>BA: .322, OBP: .458, SLG: .701</p>
                        </div>
                        <div class="quick-test-btn" onclick="runRealPlayerTest('ohtani2024')">
                            <h4>âš¾ Shohei Ohtani 2024</h4>
                            <p>BA: .310, OBP: .390, SLG: .646</p>
                        </div>
                        <div class="quick-test-btn" onclick="runRealPlayerTest('soto2024')">
                            <h4>âš¾ Juan Soto 2024</h4>
                            <p>BA: .288, OBP: .419, SLG: .569</p>
                        </div>
                        <div class="quick-test-btn" onclick="runAllPlayersTest()">
                            <h4>ğŸ† å…¨å“¡å°æ¯”æ¸¬è©¦</h4>
                            <p>åŒæ™‚æ¸¬è©¦å¤šå€‹çœŸå¯¦çƒå“¡</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- å°æ¯”çµæœé¡¯ç¤º -->
            <div id="comparisonResults"></div>
        </div>
    </div>

    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="../src/js/constants.js"></script>
    <script src="../src/js/probability_model.js"></script>
    <script src="../src/js/simulation_engine.js"></script>
    <script src="../src/js/ovr_calculator.js"></script>
    <script src="../src/js/reverse_engineer.js"></script>
    <script src="../src/js/main.js"></script>

    <script>
        // ================================== 
        // å…¨å±€è®Šæ•¸
        // ==================================
        let currentAttribute = 'pow';
        let currentTest = null;
        
        // ================================== 
        // æ¨™ç±¤åˆ‡æ›ç³»çµ±
        // ==================================
        function switchTab(tabName) {
            // éš±è—æ‰€æœ‰æ¨™ç±¤å…§å®¹
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // é¡¯ç¤ºé¸ä¸­çš„æ¨™ç±¤
            document.getElementById(tabName).style.display = 'block';
            document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
        }
        
        // ================================== 
        // å±¬æ€§é¸æ“‡
        // ==================================
        function selectAttribute(attr) {
            currentAttribute = attr;
            document.querySelectorAll('.attribute-btn[data-attr]').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-attr="${attr}"]`).classList.add('active');
        }
        
        // ================================== 
        // æ ¸å¿ƒæ¸¬è©¦å‡½æ•¸
        // ==================================
        function runEssentialTest() {
            showLoadingResults('analysisResults', 'æ­£åœ¨é‹è¡Œæ ¸å¿ƒç­‰ç´šæ¸¬è©¦...');
            
            setTimeout(() => {
                const results = performEssentialTest();
                displayResults('analysisResults', results);
            }, 1000);
        }
        
        function performEssentialTest() {
            const coreLevels = [
                { label: 'åŸºç¤ç´š (40/40/40)', pow: 40, hit: 40, eye: 40, target: { BA: 0.210, OBP: 0.280, SLG: 0.320, HR: 4 }},
                { label: 'è¯ç›Ÿå¹³å‡ (70/70/70)', pow: 70, hit: 70, eye: 70, target: { BA: 0.260, OBP: 0.330, SLG: 0.440, HR: 21 }},
                { label: 'ç²¾è‹±ç´š (100/100/100)', pow: 100, hit: 100, eye: 100, target: { BA: 0.320, OBP: 0.420, SLG: 0.600, HR: 45 }},
                { label: 'MVPç´š (120/120/120)', pow: 120, hit: 120, eye: 120, target: { BA: 0.350, OBP: 0.470, SLG: 0.700, HR: 55 }},
                { label: 'å‚³å¥‡ç´š (150/150/150)', pow: 150, hit: 150, eye: 150, target: { BA: 0.400, OBP: 0.570, SLG: 0.900, HR: 70 }}
            ];
            
            let tableHTML = `
                <div class="results-container">
                    <h3>ğŸ¯ æ ¸å¿ƒç­‰ç´šæ¸¬è©¦çµæœ</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>ç­‰ç´š</th>
                                <th>BA (ç›®æ¨™)</th>
                                <th>OBP (ç›®æ¨™)</th>
                                <th>SLG (ç›®æ¨™)</th>
                                <th>HR (ç›®æ¨™)</th>
                                <th>æº–ç¢ºåº¦</th>
                                <th>ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            let totalAccuracy = 0;
            coreLevels.forEach((level, index) => {
                const stats = simulatePlayerStats(level.pow, level.hit, level.eye, 50, 600);
                const hr = Math.round(stats.HR_count);
                
                // è¨ˆç®—æº–ç¢ºåº¦
                const baError = Math.abs(stats.BA - level.target.BA) / level.target.BA * 100;
                const obpError = Math.abs(stats.OBP - level.target.OBP) / level.target.OBP * 100;
                const slgError = Math.abs(stats.SLG - level.target.SLG) / level.target.SLG * 100;
                const hrError = Math.abs(hr - level.target.HR) / level.target.HR * 100;
                
                const maxError = Math.max(baError, obpError, slgError, hrError);
                const accuracy = Math.max(0, 100 - maxError);
                totalAccuracy += accuracy;
                
                let status = 'excellent';
                let statusText = 'å„ªç§€';
                if (maxError > 15) { status = 'poor'; statusText = 'éœ€æ”¹é€²'; }
                else if (maxError > 10) { status = 'fair'; statusText = 'å¯æ¥å—'; }
                else if (maxError > 5) { status = 'good'; statusText = 'è‰¯å¥½'; }
                
                const isHighlight = level.pow === 100;
                
                tableHTML += `
                    <tr ${isHighlight ? 'class="highlight-row"' : ''}>
                        <td><strong>${level.label}</strong></td>
                        <td>${stats.BA.toFixed(3)} <small>(${level.target.BA.toFixed(3)})</small></td>
                        <td>${stats.OBP.toFixed(3)} <small>(${level.target.OBP.toFixed(3)})</small></td>
                        <td>${stats.SLG.toFixed(3)} <small>(${level.target.SLG.toFixed(3)})</small></td>
                        <td><strong>${hr}</strong> <small>(${level.target.HR})</small></td>
                        <td>${accuracy.toFixed(1)}%</td>
                        <td><span class="status-indicator status-${status}">
                            <span class="status-dot"></span>${statusText}
                        </span></td>
                    </tr>
                `;
            });
            
            const avgAccuracy = totalAccuracy / coreLevels.length;
            tableHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>æ¸¬è©¦æ‘˜è¦:</strong> å¹³å‡æº–ç¢ºåº¦ <strong>${avgAccuracy.toFixed(1)}%</strong> 
                        ${avgAccuracy >= 90 ? 'ğŸ‰ æ¨¡å‹è¡¨ç¾å„ªç§€ï¼' : avgAccuracy >= 80 ? 'âœ… æ¨¡å‹è¡¨ç¾è‰¯å¥½' : 'âš ï¸ æ¨¡å‹éœ€è¦èª¿æ•´'}
                    </div>
                </div>
            `;
            
            return tableHTML;
        }
        
        // ================================== 
        // å±¬æ€§åˆ†æ
        // ==================================
        function runAttributeAnalysis(scenario) {
            showLoadingResults('isolationResults', `æ­£åœ¨åˆ†æ ${currentAttribute.toUpperCase()} å±¬æ€§åœ¨${getScenarioName(scenario)}ç’°å¢ƒä¸‹çš„è¡¨ç¾...`);
            
            setTimeout(() => {
                const results = performAttributeAnalysis(currentAttribute, scenario);
                displayResults('isolationResults', results);
            }, 800);
        }
        
        function performAttributeAnalysis(attribute, scenario) {
            let baseValues;
            if (scenario === 'standard') baseValues = [70, 70];
            else if (scenario === 'bottom') baseValues = [40, 40];
            else baseValues = [100, 100];
            
            const testRange = [];
            for (let val = 40; val <= 150; val += 10) {
                testRange.push(val);
            }
            
            let tableHTML = `
                <div class="results-container">
                    <h3>ğŸ“Š ${attribute.toUpperCase()} æ¨¡å‹åˆ†æ - ${getScenarioName(scenario)}</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>${attribute.toUpperCase()}</th>
                                <th>BA</th>
                                <th>OBP</th>
                                <th>SLG</th>
                                <th>OPS</th>
                                <th>HR</th>
                                <th>2B</th>
                                <th>XBH</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            testRange.forEach(testVal => {
                let pow, hit, eye;
                if (attribute === 'pow') { pow = testVal; hit = baseValues[0]; eye = baseValues[1]; }
                else if (attribute === 'hit') { hit = testVal; pow = baseValues[0]; eye = baseValues[1]; }
                else { eye = testVal; pow = baseValues[0]; hit = baseValues[1]; }
                
                const stats = simulatePlayerStats(pow, hit, eye, 20, 600);
                const hr = Math.round(stats.HR_count);
                const doubles = Math.round(stats.doubles_count || 0);
                const xbh = hr + doubles;
                
                const isHighlight = testVal === 100;
                
                // æ ¹æ“šä¸åŒå±¬æ€§æ±ºå®šé‡é»æŒ‡æ¨™çš„é¡è‰²
                let baStyle = '';
                let obpStyle = '';
                let hrStyle = '';
                
                if (attribute === 'pow') {
                    hrStyle = 'color: var(--error); font-weight: bold;';  // POW é‡é»é¡¯ç¤º HR
                } else if (attribute === 'hit') {
                    baStyle = 'color: var(--error); font-weight: bold;';  // HIT é‡é»é¡¯ç¤º BA
                } else if (attribute === 'eye') {
                    obpStyle = 'color: var(--error); font-weight: bold;'; // EYE é‡é»é¡¯ç¤º OBP
                }
                
                tableHTML += `
                    <tr ${isHighlight ? 'class="highlight-row"' : ''}>
                        <td><strong>${testVal}</strong></td>
                        <td><strong style="${baStyle}">${stats.BA.toFixed(3)}</strong></td>
                        <td><strong style="${obpStyle}">${stats.OBP.toFixed(3)}</strong></td>
                        <td>${stats.SLG.toFixed(3)}</td>
                        <td>${stats.OPS.toFixed(3)}</td>
                        <td><strong style="${hrStyle}">${hr}</strong></td>
                        <td>${doubles}</td>
                        <td><strong>${xbh}</strong></td>
                    </tr>
                `;
            });
            
            let focusDescription = '';
            if (attribute === 'pow') {
                focusDescription = 'ç´…è‰²æ•¸å­—ç‚ºå…¨å£˜æ‰“æ•¸ (HR)ï¼Œå±•ç¤º POW å±¬æ€§å°é•·æ‰“åŠ›çš„ç›´æ¥å½±éŸ¿';
            } else if (attribute === 'hit') {
                focusDescription = 'ç´…è‰²æ•¸å­—ç‚ºæ‰“æ“Šç‡ (BA)ï¼Œå±•ç¤º HIT å±¬æ€§å°æ¥è§¸æˆåŠŸç‡çš„ç›´æ¥å½±éŸ¿';
            } else if (attribute === 'eye') {
                focusDescription = 'ç´…è‰²æ•¸å­—ç‚ºä¸Šå£˜ç‡ (OBP)ï¼Œå±•ç¤º EYE å±¬æ€§å°é¸çƒå’Œä¸Šå£˜èƒ½åŠ›çš„ç›´æ¥å½±éŸ¿';
            }
            
            tableHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>èªªæ˜:</strong> ç¶ è‰²è¡Œç‚º ${attribute.toUpperCase()} 100 (ç²¾è‹±ç´š)ï¼Œ${focusDescription}ã€‚
                        å…¶ä»–å±¬æ€§å›ºå®šç‚º${getScenarioName(scenario).replace('ç’°å¢ƒ', '')}ã€‚
                    </div>
                </div>
            `;
            
            return tableHTML;
        }
        
        // ================================== 
        // é©—è­‰æ¸¬è©¦å‡½æ•¸
        // ==================================
        function runPrecisionTest() {
            showLoadingResults('validationResults', 'æ­£åœ¨é‹è¡Œç²¾ç¢ºåº¦æ¸¬è©¦...');
            
            setTimeout(() => {
                const stats = simulatePlayerStats(100, 100, 100, 100, 600);
                const results = `
                    <div class="results-container">
                        <h3>ğŸ¯ ç²¾ç¢ºåº¦æ¸¬è©¦çµæœ (100/100/100)</h3>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                            <div style="text-align: center; padding: 16px; background: var(--bg-header); border-radius: var(--radius-md);">
                                <h4>BA</h4>
                                <div><strong>${stats.BA.toFixed(3)}</strong></div>
                                <div><small>ç›®æ¨™: 0.320</small></div>
                                <div><small>èª¤å·®: ${Math.abs(stats.BA - 0.320).toFixed(3)}</small></div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: var(--bg-header); border-radius: var(--radius-md);">
                                <h4>OBP</h4>
                                <div><strong>${stats.OBP.toFixed(3)}</strong></div>
                                <div><small>ç›®æ¨™: 0.420</small></div>
                                <div><small>èª¤å·®: ${Math.abs(stats.OBP - 0.420).toFixed(3)}</small></div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: var(--bg-header); border-radius: var(--radius-md);">
                                <h4>SLG</h4>
                                <div><strong>${stats.SLG.toFixed(3)}</strong></div>
                                <div><small>ç›®æ¨™: 0.600</small></div>
                                <div><small>èª¤å·®: ${Math.abs(stats.SLG - 0.600).toFixed(3)}</small></div>
                            </div>
                            <div style="text-align: center; padding: 16px; background: var(--bg-header); border-radius: var(--radius-md);">
                                <h4>HR</h4>
                                <div><strong>${Math.round(stats.HR_count)}</strong></div>
                                <div><small>ç›®æ¨™: 45</small></div>
                                <div><small>èª¤å·®: ${Math.abs(Math.round(stats.HR_count) - 45)}</small></div>
                            </div>
                        </div>
                    </div>
                `;
                displayResults('validationResults', results);
            }, 800);
        }
        
        function runBalanceTest() {
            showLoadingResults('validationResults', 'æ­£åœ¨æª¢æŸ¥æ¨¡å‹å¹³è¡¡æ€§...');
            
            setTimeout(() => {
                const testCases = [
                    { label: 'åŸºç¤ (70/70/70)', pow: 70, hit: 70, eye: 70 },
                    { label: 'ç²¾è‹± (100/100/100)', pow: 100, hit: 100, eye: 100 },
                    { label: 'å‚³å¥‡ (130/130/130)', pow: 130, hit: 130, eye: 130 },
                    { label: 'æ¥µé™ (150/150/150)', pow: 150, hit: 150, eye: 150 }
                ];
                
                let resultHTML = `
                    <div class="results-container">
                        <h3>âš–ï¸ æ¨¡å‹å¹³è¡¡æ€§æª¢æŸ¥</h3>
                `;
                
                testCases.forEach(test => {
                    const stats = simulatePlayerStats(test.pow, test.hit, test.eye, 50, 600);
                    const hr = Math.round(stats.HR_count);
                    const doubles = Math.round(stats.doubles_count);
                    
                    const baOk = stats.BA >= 0.200 && stats.BA <= 0.450;
                    const obpOk = stats.OBP >= 0.280 && stats.OBP <= 0.650;
                    const slgOk = stats.SLG >= 0.300 && stats.SLG <= 1.000;
                    const hrOk = hr >= 5 && hr <= 80;
                    
                    const allOk = baOk && obpOk && slgOk && hrOk;
                    const statusClass = allOk ? 'excellent' : 'fair';
                    const statusText = allOk ? 'æ­£å¸¸ç¯„åœ' : 'éœ€é—œæ³¨';
                    
                    resultHTML += `
                        <div style="margin: 12px 0; padding: 16px; background: ${allOk ? 'var(--accent-light)' : '#FFF3CD'}; border-radius: var(--radius-md); border-left: 4px solid ${allOk ? 'var(--success)' : 'var(--warning)'};">
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;">
                                <strong>${test.label}</strong>
                                <span class="status-indicator status-${statusClass}">
                                    <span class="status-dot"></span>${statusText}
                                </span>
                            </div>
                            <div style="display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; font-size: 0.9em;">
                                <div>BA: <strong>${stats.BA.toFixed(3)}</strong></div>
                                <div>OBP: <strong>${stats.OBP.toFixed(3)}</strong></div>
                                <div>SLG: <strong>${stats.SLG.toFixed(3)}</strong></div>
                                <div>HR: <strong>${hr}</strong></div>
                            </div>
                        </div>
                    `;
                });
                
                resultHTML += '</div>';
                displayResults('validationResults', resultHTML);
            }, 1000);
        }
        
        // ================================== 
        // çœŸå¯¦çƒå“¡å°æ¯”
        // ==================================
        function runRealPlayerTest(playerKey) {
            const players = {
                'judge2024': { name: 'Aaron Judge 2024', BA: 0.322, OBP: 0.458, SLG: 0.701, HR: 58 },
                'ohtani2024': { name: 'Shohei Ohtani 2024', BA: 0.310, OBP: 0.390, SLG: 0.646, HR: 54 },
                'soto2024': { name: 'Juan Soto 2024', BA: 0.288, OBP: 0.419, SLG: 0.569, HR: 41 }
            };
            
            const player = players[playerKey];
            showLoadingResults('comparisonResults', `æ­£åœ¨åˆ†æ ${player.name} çš„æ•¸æ“š...`);
            
            setTimeout(() => {
                const results = performRealPlayerAnalysis(player);
                displayResults('comparisonResults', results);
            }, 1200);
        }
        
        function performRealPlayerAnalysis(player) {
            // ä½¿ç”¨ä¸»ç³»çµ±çš„é€†å‘å·¥ç¨‹é€²è¡Œå±¬æ€§ä¼°ç®—
            const targetStats = {
                BA: player.BA,
                OBP: player.OBP, 
                SLG: player.SLG,
                PA: 600
            };
            
            // èª¿ç”¨ä¸»ç³»çµ±çš„é€†å‘å·¥ç¨‹å‡½æ•¸
            const engineeredResult = reverseEngineerAttributes(targetStats);
            const estimatedPow = engineeredResult.attributes.POW;
            const estimatedHit = engineeredResult.attributes.HIT;
            const estimatedEye = engineeredResult.attributes.EYE;
            
            // ä½¿ç”¨ä¼°ç®—å±¬æ€§é€²è¡Œæ¨¡æ“¬é©—è­‰
            const modelStats = simulatePlayerStats(estimatedPow, estimatedHit, estimatedEye, 100, 600);
            const modelHR = Math.round(modelStats.HR_count);
            
            // è¨ˆç®—èª¤å·®
            const baError = Math.abs(modelStats.BA - player.BA);
            const obpError = Math.abs(modelStats.OBP - player.OBP);  
            const slgError = Math.abs(modelStats.SLG - player.SLG);
            const hrError = Math.abs(modelHR - player.HR);
            
            // è¨ˆç®—æº–ç¢ºåº¦è©•åˆ†
            const baAccuracy = Math.max(0, 100 - (baError / player.BA * 100));
            const obpAccuracy = Math.max(0, 100 - (obpError / player.OBP * 100));
            const slgAccuracy = Math.max(0, 100 - (slgError / player.SLG * 100));
            const hrAccuracy = Math.max(0, 100 - (hrError / player.HR * 100));
            const overallAccuracy = (baAccuracy + obpAccuracy + slgAccuracy + hrAccuracy) / 4;
            
            // ä½¿ç”¨æ–°çš„ç¸½å’Œå¯¦åŠ›OVRè¨ˆç®—
            const ovrResult = calculateBatterOVR(estimatedPow, estimatedHit, estimatedEye);
            const estimatedOVR = ovrResult.ovr;
            
            // çƒå“¡é¡å‹åˆ†æ
            let playerType = '';
            let typeDescription = '';
            if (player.HR >= 50 && player.SLG >= 0.650) {
                playerType = 'è¶…ç´šå¼·æ‰“è€…';
                typeDescription = 'æ¥µé«˜é•·æ‰“åŠ›ï¼ŒMVPç´šåˆ¥è¡¨ç¾';
            } else if (player.HR >= 35 && player.SLG >= 0.550) {
                playerType = 'å¼·æ‰“è€…';
                typeDescription = 'å„ªç§€é•·æ‰“åŠ›ï¼Œå…¨æ˜æ˜Ÿç´šåˆ¥';
            } else if (player.BA >= 0.320 && player.OBP >= 0.380) {
                playerType = 'é«˜æ‰“æ“Šç‡å‹';
                typeDescription = 'å„ªç§€æ¥è§¸èƒ½åŠ›å’Œä¸Šå£˜èƒ½åŠ›';
            } else if (player.OBP >= 0.400) {
                playerType = 'ä¸Šå£˜ç‡å‹';
                typeDescription = 'å„ªç§€é¸çƒèƒ½åŠ›å’Œä¸Šå£˜æŠ€å·§';
            } else {
                playerType = 'å¹³è¡¡å‹';
                typeDescription = 'å„é …èƒ½åŠ›å‡è¡¡ç™¼å±•';
            }
            
            let accuracyColor = '';
            if (overallAccuracy >= 85) accuracyColor = 'var(--success)';
            else if (overallAccuracy >= 75) accuracyColor = 'var(--info)';
            else if (overallAccuracy >= 65) accuracyColor = 'var(--warning)';
            else accuracyColor = 'var(--error)';
            
            return `
                <div class="results-container">
                    <h3>ğŸŒŸ ${player.name} å®Œæ•´åˆ†æ</h3>
                    
                    <!-- æ¦‚è¦½å¡ç‰‡ -->
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 16px; margin-bottom: 24px;">
                        <div style="padding: 20px; background: var(--bg-header); border-radius: var(--radius-md);">
                            <h4 style="margin: 0 0 12px 0; color: var(--accent-primary);">çœŸå¯¦æ•¸æ“š (2024)</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em;">
                                <div>BA: <strong>${player.BA}</strong></div>
                                <div>OBP: <strong>${player.OBP}</strong></div>
                                <div>SLG: <strong>${player.SLG}</strong></div>
                                <div>OPS: <strong>${(player.OBP + player.SLG).toFixed(3)}</strong></div>
                            </div>
                            <div style="margin-top: 12px; padding: 8px; background: var(--accent-light); border-radius: var(--radius-sm); text-align: center;">
                                <strong style="color: var(--error);">${player.HR} HR</strong>
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: var(--accent-light); border-radius: var(--radius-md);">
                            <h4 style="margin: 0 0 12px 0; color: var(--accent-secondary);">é ä¼°å±¬æ€§</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em;">
                                <div>POW: <strong>${estimatedPow}</strong></div>
                                <div>HIT: <strong>${estimatedHit}</strong></div>
                                <div>EYE: <strong>${estimatedEye}</strong></div>
                                <div>OVR: <strong>${estimatedOVR}</strong></div>
                            </div>
                            <div style="margin-top: 8px; font-size: 0.8em;">
                                <div>æ¨¡æ“¬ wOBA: ${ovrResult.breakdown.simulatedWOBA}</div>
                                <div>æ˜ å°„ OVR: ${ovrResult.breakdown.rawOVR}</div>
                                <div>å‡è¡¡æ¯”ä¾‹: ${ovrResult.breakdown.balanceRatio}</div>
                            </div>
                            <div style="margin-top: 12px; padding: 8px; background: white; border-radius: var(--radius-sm); text-align: center;">
                                <strong>${playerType}</strong>
                                <div style="font-size: 0.8em; color: var(--text-secondary); margin-top: 4px;">${typeDescription}</div>
                            </div>
                        </div>
                        
                        <div style="padding: 20px; background: var(--bg-surface); border: 1px solid #E5E5E5; border-radius: var(--radius-md);">
                            <h4 style="margin: 0 0 12px 0; color: var(--text-primary);">æ¨¡å‹é©—è­‰</h4>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 0.9em;">
                                <div>æ¨¡æ“¬ BA: <strong>${modelStats.BA.toFixed(3)}</strong></div>
                                <div>æ¨¡æ“¬ OBP: <strong>${modelStats.OBP.toFixed(3)}</strong></div>
                                <div>æ¨¡æ“¬ SLG: <strong>${modelStats.SLG.toFixed(3)}</strong></div>
                                <div>æ¨¡æ“¬ HR: <strong>${modelHR}</strong></div>
                            </div>
                            <div style="margin-top: 12px; padding: 8px; background: ${overallAccuracy >= 80 ? 'var(--accent-light)' : '#FFF3CD'}; border-radius: var(--radius-sm); text-align: center;">
                                <strong style="color: ${accuracyColor};">æº–ç¢ºåº¦: ${overallAccuracy.toFixed(1)}%</strong>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è©³ç´°èª¤å·®åˆ†æ -->
                    <h4 style="color: var(--accent-primary); margin: 24px 0 12px 0;">èª¤å·®åˆ†æ</h4>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>çµ±è¨ˆé …ç›®</th>
                                <th>çœŸå¯¦å€¼</th>
                                <th>æ¨¡æ“¬å€¼</th>
                                <th>çµ•å°èª¤å·®</th>
                                <th>ç›¸å°èª¤å·®</th>
                                <th>æº–ç¢ºåº¦è©•ç´š</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>BA</strong></td>
                                <td>${player.BA}</td>
                                <td>${modelStats.BA.toFixed(3)}</td>
                                <td>${baError.toFixed(3)}</td>
                                <td>${(baError/player.BA*100).toFixed(1)}%</td>
                                <td><span style="color: ${baAccuracy >= 90 ? 'var(--success)' : baAccuracy >= 80 ? 'var(--info)' : 'var(--warning)'}; font-weight: bold;">
                                    ${baAccuracy >= 90 ? 'å„ªç§€' : baAccuracy >= 80 ? 'è‰¯å¥½' : 'å¯æ¥å—'}
                                </span></td>
                            </tr>
                            <tr>
                                <td><strong>OBP</strong></td>
                                <td>${player.OBP}</td>
                                <td>${modelStats.OBP.toFixed(3)}</td>
                                <td>${obpError.toFixed(3)}</td>
                                <td>${(obpError/player.OBP*100).toFixed(1)}%</td>
                                <td><span style="color: ${obpAccuracy >= 90 ? 'var(--success)' : obpAccuracy >= 80 ? 'var(--info)' : 'var(--warning)'}; font-weight: bold;">
                                    ${obpAccuracy >= 90 ? 'å„ªç§€' : obpAccuracy >= 80 ? 'è‰¯å¥½' : 'å¯æ¥å—'}
                                </span></td>
                            </tr>
                            <tr>
                                <td><strong>SLG</strong></td>
                                <td>${player.SLG}</td>
                                <td>${modelStats.SLG.toFixed(3)}</td>
                                <td>${slgError.toFixed(3)}</td>
                                <td>${(slgError/player.SLG*100).toFixed(1)}%</td>
                                <td><span style="color: ${slgAccuracy >= 90 ? 'var(--success)' : slgAccuracy >= 80 ? 'var(--info)' : 'var(--warning)'}; font-weight: bold;">
                                    ${slgAccuracy >= 90 ? 'å„ªç§€' : slgAccuracy >= 80 ? 'è‰¯å¥½' : 'å¯æ¥å—'}
                                </span></td>
                            </tr>
                            <tr>
                                <td><strong>HR</strong></td>
                                <td>${player.HR}</td>
                                <td>${modelHR}</td>
                                <td>${hrError}</td>
                                <td>${(hrError/player.HR*100).toFixed(1)}%</td>
                                <td><span style="color: ${hrAccuracy >= 90 ? 'var(--success)' : hrAccuracy >= 80 ? 'var(--info)' : 'var(--warning)'}; font-weight: bold;">
                                    ${hrAccuracy >= 90 ? 'å„ªç§€' : hrAccuracy >= 80 ? 'è‰¯å¥½' : 'å¯æ¥å—'}
                                </span></td>
                            </tr>
                        </tbody>
                    </table>
                    
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>åˆ†æç¸½çµ:</strong> ${player.name} è¢«åˆ†é¡ç‚º <strong>${playerType}</strong>ï¼Œæ¨¡å‹æ•´é«”æº–ç¢ºåº¦ç‚º <strong>${overallAccuracy.toFixed(1)}%</strong>ã€‚
                        ${overallAccuracy >= 85 ? 'æ¨¡å‹è¡¨ç¾å„ªç§€ï¼Œèƒ½æº–ç¢ºé æ¸¬è©²çƒå“¡çš„çµ±è¨ˆè¡¨ç¾ã€‚' : 
                          overallAccuracy >= 75 ? 'æ¨¡å‹è¡¨ç¾è‰¯å¥½ï¼Œå¤§è‡´èƒ½åæ˜ è©²çƒå“¡çš„ç‰¹é»ã€‚' : 
                          'æ¨¡å‹éœ€è¦é€²ä¸€æ­¥èª¿æ•´ä»¥æ›´å¥½åœ°æ¨¡æ“¬è©²çƒå“¡é¡å‹ã€‚'}
                    </div>
                </div>
            `;
        }
        
        // ================================== 
        // å·¥å…·å‡½æ•¸
        // ==================================
        function showLoadingResults(containerId, message) {
            const container = document.getElementById(containerId);
            container.innerHTML = `
                <div class="loading-indicator">
                    <span class="spinner"></span>
                    ${message}
                </div>
            `;
        }
        
        function displayResults(containerId, htmlContent) {
            document.getElementById(containerId).innerHTML = htmlContent;
        }
        
        function getScenarioName(scenario) {
            switch(scenario) {
                case 'standard': return 'æ¨™æº–ç’°å¢ƒ (70/70)';
                case 'bottom': return 'åº•ç·šç’°å¢ƒ (40/40)';
                case 'elite': return 'é ‚ç·šç’°å¢ƒ (100/100)';
                default: return 'æœªçŸ¥ç’°å¢ƒ';
            }
        }
        
        // ================================== 
        // å®Œæ•´æ¸¬è©¦å‡½æ•¸å¯¦ç¾
        // ==================================
        
        
        function runPerformanceTest() {
            showLoadingResults('analysisResults', 'æ­£åœ¨é‹è¡Œæ€§èƒ½åŸºæº–æ¸¬è©¦...');
            setTimeout(() => {
                const results = performPerformanceTest();
                displayResults('analysisResults', results);
            }, 2000);
        }
        
        function performPerformanceTest() {
            const testCases = [
                { name: 'å¿«é€Ÿæ¸¬è©¦ (10æ¬¡)', simulations: 10, pa: 600 },
                { name: 'æ¨™æº–æ¸¬è©¦ (50æ¬¡)', simulations: 50, pa: 600 },
                { name: 'é«˜ç²¾åº¦æ¸¬è©¦ (100æ¬¡)', simulations: 100, pa: 600 },
                { name: 'è¶…å¤§æ¨£æœ¬ (200æ¬¡)', simulations: 200, pa: 600 }
            ];
            
            let resultHTML = `
                <div class="results-container">
                    <h3>âš¡ æ€§èƒ½åŸºæº–æ¸¬è©¦çµæœ</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>æ¸¬è©¦é¡å‹</th>
                                <th>æ¨¡æ“¬æ¬¡æ•¸</th>
                                <th>åŸ·è¡Œæ™‚é–“ (ms)</th>
                                <th>å¹³å‡ BA</th>
                                <th>ç©©å®šæ€§è©•åˆ†</th>
                                <th>æ€§èƒ½ç­‰ç´š</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            testCases.forEach(testCase => {
                const startTime = performance.now();
                const runs = 5; // åŸ·è¡Œ5æ¬¡å–å¹³å‡
                const results = [];
                
                for (let i = 0; i < runs; i++) {
                    const stats = simulatePlayerStats(100, 100, 100, testCase.simulations, testCase.pa);
                    results.push(stats.BA);
                }
                
                const endTime = performance.now();
                const avgTime = (endTime - startTime) / runs;
                const avgBA = results.reduce((a, b) => a + b) / results.length;
                const variance = results.reduce((acc, val) => acc + Math.pow(val - avgBA, 2), 0) / results.length;
                const stability = Math.max(0, 100 - (variance * 10000)); // è½‰æ›ç‚ºç©©å®šæ€§è©•åˆ†
                
                let performanceGrade = '';
                let gradeColor = '';
                if (avgTime < 50) { performanceGrade = 'å„ªç§€'; gradeColor = 'var(--success)'; }
                else if (avgTime < 100) { performanceGrade = 'è‰¯å¥½'; gradeColor = 'var(--info)'; }
                else if (avgTime < 200) { performanceGrade = 'å¯æ¥å—'; gradeColor = 'var(--warning)'; }
                else { performanceGrade = 'éœ€å„ªåŒ–'; gradeColor = 'var(--error)'; }
                
                resultHTML += `
                    <tr>
                        <td><strong>${testCase.name}</strong></td>
                        <td>${testCase.simulations}</td>
                        <td>${avgTime.toFixed(1)}ms</td>
                        <td>${avgBA.toFixed(4)}</td>
                        <td>${stability.toFixed(1)}%</td>
                        <td><span style="color: ${gradeColor}; font-weight: bold;">${performanceGrade}</span></td>
                    </tr>
                `;
            });
            
            resultHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>æ€§èƒ½æ‘˜è¦:</strong> æ–°ç°¡åŒ–æ¨¡å‹å¹³å‡åŸ·è¡Œæ™‚é–“å¤§å¹…å„ªæ–¼èˆŠæ¨¡å‹ï¼Œç©©å®šæ€§è©•åˆ†åŸºæ–¼å¤šæ¬¡é‹è¡Œçš„æ–¹å·®è¨ˆç®—ã€‚
                        åŸ·è¡Œæ™‚é–“ &lt;50ms ç‚ºå„ªç§€ï¼Œ&lt;100ms ç‚ºè‰¯å¥½ã€‚
                    </div>
                </div>
            `;
            
            return resultHTML;
        }
        
        function runRangeValidationTest() {
            showLoadingResults('analysisResults', 'æ­£åœ¨é‹è¡Œç¯„åœé©—è­‰æ¸¬è©¦...');
            setTimeout(() => {
                const results = performRangeValidationTest();
                displayResults('analysisResults', results);
            }, 1000);
        }
        
        function performRangeValidationTest() {
            const extremeTests = [
                { name: 'æ¥µä½èƒ½åŠ› (1/1/1)', pow: 1, hit: 1, eye: 1, expected: { BA: [0.01, 0.15], OBP: [0.05, 0.20], SLG: [0.01, 0.20] }},
                { name: 'æ¥­é¤˜æ°´æº– (20/20/20)', pow: 20, hit: 20, eye: 20, expected: { BA: [0.15, 0.25], OBP: [0.20, 0.30], SLG: [0.20, 0.35] }},
                { name: 'MLBä¸‹é™ (40/40/40)', pow: 40, hit: 40, eye: 40, expected: { BA: [0.18, 0.25], OBP: [0.25, 0.32], SLG: [0.28, 0.38] }},
                { name: 'è¶…äººæ°´æº– (200/200/200)', pow: 200, hit: 200, eye: 200, expected: { BA: [0.40, 0.60], OBP: [0.60, 0.80], SLG: [1.00, 2.00] }},
                { name: 'ç†è«–æ¥µé™ (500/500/500)', pow: 500, hit: 500, eye: 500, expected: { BA: [0.85, 1.00], OBP: [0.90, 1.00], SLG: [3.50, 4.00] }}
            ];
            
            let resultHTML = `
                <div class="results-container">
                    <h3>ğŸ“Š ç¯„åœé©—è­‰æ¸¬è©¦çµæœ</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>æ¸¬è©¦æ¡ˆä¾‹</th>
                                <th>BA (é æœŸç¯„åœ)</th>
                                <th>OBP (é æœŸç¯„åœ)</th>
                                <th>SLG (é æœŸç¯„åœ)</th>
                                <th>HR</th>
                                <th>åˆç†æ€§è©•ä¼°</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            extremeTests.forEach(test => {
                const stats = simulatePlayerStats(test.pow, test.hit, test.eye, 50, 600);
                const hr = Math.round(stats.HR_count);
                
                // æª¢æŸ¥æ˜¯å¦åœ¨é æœŸç¯„åœå…§
                const baInRange = stats.BA >= test.expected.BA[0] && stats.BA <= test.expected.BA[1];
                const obpInRange = stats.OBP >= test.expected.OBP[0] && stats.OBP <= test.expected.OBP[1];
                const slgInRange = stats.SLG >= test.expected.SLG[0] && stats.SLG <= test.expected.SLG[1];
                
                const validCount = [baInRange, obpInRange, slgInRange].filter(Boolean).length;
                let reasonability = '';
                let reasonabilityColor = '';
                
                if (validCount === 3) { reasonability = 'å®Œå…¨åˆç†'; reasonabilityColor = 'var(--success)'; }
                else if (validCount === 2) { reasonability = 'åŸºæœ¬åˆç†'; reasonabilityColor = 'var(--info)'; }
                else if (validCount === 1) { reasonability = 'éƒ¨åˆ†ç•°å¸¸'; reasonabilityColor = 'var(--warning)'; }
                else { reasonability = 'ç¯„åœç•°å¸¸'; reasonabilityColor = 'var(--error)'; }
                
                resultHTML += `
                    <tr>
                        <td><strong>${test.name}</strong></td>
                        <td style="background: ${baInRange ? 'var(--accent-light)' : '#FFE6E6'};">
                            ${stats.BA.toFixed(3)} <small>(${test.expected.BA[0].toFixed(2)}-${test.expected.BA[1].toFixed(2)})</small>
                        </td>
                        <td style="background: ${obpInRange ? 'var(--accent-light)' : '#FFE6E6'};">
                            ${stats.OBP.toFixed(3)} <small>(${test.expected.OBP[0].toFixed(2)}-${test.expected.OBP[1].toFixed(2)})</small>
                        </td>
                        <td style="background: ${slgInRange ? 'var(--accent-light)' : '#FFE6E6'};">
                            ${stats.SLG.toFixed(3)} <small>(${test.expected.SLG[0].toFixed(2)}-${test.expected.SLG[1].toFixed(2)})</small>
                        </td>
                        <td>${hr}</td>
                        <td><span style="color: ${reasonabilityColor}; font-weight: bold;">${reasonability}</span></td>
                    </tr>
                `;
            });
            
            resultHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>é©—è­‰èªªæ˜:</strong> ç¶ è‰²èƒŒæ™¯è¡¨ç¤ºæ•¸å€¼åœ¨é æœŸç¯„åœå…§ï¼Œç´…è‰²èƒŒæ™¯è¡¨ç¤ºè¶…å‡ºé æœŸç¯„åœã€‚
                        æ¥µç«¯æ•¸å€¼æ¸¬è©¦å¹«åŠ©ç¢ºä¿æ¨¡å‹åœ¨æ‰€æœ‰è¼¸å…¥ç¯„åœå…§éƒ½èƒ½ç”¢ç”Ÿåˆç†çµæœã€‚
                    </div>
                </div>
            `;
            
            return resultHTML;
        }
        
        function runConsistencyTest() {
            showLoadingResults('validationResults', 'æ­£åœ¨æ¸¬è©¦ä¸€è‡´æ€§...');
            setTimeout(() => {
                const results = performConsistencyTest();
                displayResults('validationResults', results);
            }, 1500);
        }
        
        function performConsistencyTest() {
            const testCombinations = [
                { name: 'åŸºæº–çµ„åˆ', pow: 70, hit: 70, eye: 70 },
                { name: 'ç²¾è‹±çµ„åˆ', pow: 100, hit: 100, eye: 100 },
                { name: 'ä¸å¹³è¡¡çµ„åˆA', pow: 120, hit: 80, eye: 60 },
                { name: 'ä¸å¹³è¡¡çµ„åˆB', pow: 60, hit: 120, eye: 80 }
            ];
            
            let resultHTML = `
                <div class="results-container">
                    <h3>ğŸ”„ ä¸€è‡´æ€§æ¸¬è©¦çµæœ</h3>
                    <p>å°åŒä¸€çµ„åˆé‹è¡Œå¤šæ¬¡æ¸¬è©¦ï¼Œè©•ä¼°çµæœç©©å®šæ€§</p>
            `;
            
            testCombinations.forEach(combo => {
                const runs = 10;
                const results = [];
                
                // é‹è¡Œå¤šæ¬¡ç›¸åŒæ¸¬è©¦
                for (let i = 0; i < runs; i++) {
                    const stats = simulatePlayerStats(combo.pow, combo.hit, combo.eye, 30, 600);
                    results.push({
                        BA: stats.BA,
                        OBP: stats.OBP,
                        SLG: stats.SLG,
                        HR: Math.round(stats.HR_count)
                    });
                }
                
                // è¨ˆç®—çµ±è¨ˆæ•¸æ“š
                const avgBA = results.reduce((sum, r) => sum + r.BA, 0) / runs;
                const avgOBP = results.reduce((sum, r) => sum + r.OBP, 0) / runs;
                const avgSLG = results.reduce((sum, r) => sum + r.SLG, 0) / runs;
                const avgHR = results.reduce((sum, r) => sum + r.HR, 0) / runs;
                
                // è¨ˆç®—æ¨™æº–å·®
                const stdBA = Math.sqrt(results.reduce((sum, r) => sum + Math.pow(r.BA - avgBA, 2), 0) / runs);
                const stdOBP = Math.sqrt(results.reduce((sum, r) => sum + Math.pow(r.OBP - avgOBP, 2), 0) / runs);
                const stdSLG = Math.sqrt(results.reduce((sum, r) => sum + Math.pow(r.SLG - avgSLG, 2), 0) / runs);
                const stdHR = Math.sqrt(results.reduce((sum, r) => sum + Math.pow(r.HR - avgHR, 2), 0) / runs);
                
                // è¨ˆç®—è®Šç•°ä¿‚æ•¸ (CV = std/mean)
                const cvBA = (stdBA / avgBA * 100).toFixed(1);
                const cvOBP = (stdOBP / avgOBP * 100).toFixed(1);
                const cvSLG = (stdSLG / avgSLG * 100).toFixed(1);
                const cvHR = (stdHR / avgHR * 100).toFixed(1);
                
                resultHTML += `
                    <h4 style="margin-top: 24px; color: var(--accent-primary);">${combo.name} (${combo.pow}/${combo.hit}/${combo.eye})</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 12px; margin-bottom: 16px;">
                        <div style="padding: 12px; background: var(--bg-header); border-radius: var(--radius-md); text-align: center;">
                            <h5 style="margin: 0 0 8px 0;">BA ç©©å®šæ€§</h5>
                            <div><strong>${avgBA.toFixed(3)}</strong> Â±${stdBA.toFixed(3)}</div>
                            <div><small>è®Šç•°ä¿‚æ•¸: ${cvBA}%</small></div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-header); border-radius: var(--radius-md); text-align: center;">
                            <h5 style="margin: 0 0 8px 0;">OBP ç©©å®šæ€§</h5>
                            <div><strong>${avgOBP.toFixed(3)}</strong> Â±${stdOBP.toFixed(3)}</div>
                            <div><small>è®Šç•°ä¿‚æ•¸: ${cvOBP}%</small></div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-header); border-radius: var(--radius-md); text-align: center;">
                            <h5 style="margin: 0 0 8px 0;">SLG ç©©å®šæ€§</h5>
                            <div><strong>${avgSLG.toFixed(3)}</strong> Â±${stdSLG.toFixed(3)}</div>
                            <div><small>è®Šç•°ä¿‚æ•¸: ${cvSLG}%</small></div>
                        </div>
                        <div style="padding: 12px; background: var(--bg-header); border-radius: var(--radius-md); text-align: center;">
                            <h5 style="margin: 0 0 8px 0;">HR ç©©å®šæ€§</h5>
                            <div><strong>${avgHR.toFixed(1)}</strong> Â±${stdHR.toFixed(1)}</div>
                            <div><small>è®Šç•°ä¿‚æ•¸: ${cvHR}%</small></div>
                        </div>
                    </div>
                `;
            });
            
            resultHTML += `
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>ä¸€è‡´æ€§è©•ä¼°:</strong> è®Šç•°ä¿‚æ•¸ &lt;5% ç‚ºå„ªç§€ï¼Œ&lt;10% ç‚ºè‰¯å¥½ï¼Œ&lt;15% ç‚ºå¯æ¥å—ã€‚
                        è¼ƒå°çš„æ¨™æº–å·®å’Œè®Šç•°ä¿‚æ•¸è¡¨ç¤ºæ¨¡å‹çµæœæ›´ç©©å®šå¯é ã€‚
                    </div>
                </div>
            `;
            
            return resultHTML;
        }
        
        function runBidirectionalTest() {
            showLoadingResults('validationResults', 'æ­£åœ¨é‹è¡Œé›™å‘è½‰æ›æ¸¬è©¦...');
            setTimeout(() => {
                const results = performBidirectionalTest();
                displayResults('validationResults', results);
            }, 1200);
        }
        
        function performBidirectionalTest() {
            const testCases = [
                { name: 'ç²¾è‹±åŸºæº–', attrs: { pow: 100, hit: 100, eye: 100 }, targets: { BA: 0.320, OBP: 0.420, SLG: 0.600 }},
                { name: 'è¯ç›Ÿå¹³å‡', attrs: { pow: 70, hit: 70, eye: 70 }, targets: { BA: 0.260, OBP: 0.330, SLG: 0.440 }},
                { name: 'ä¸å¹³è¡¡A', attrs: { pow: 120, hit: 80, eye: 60 }, targets: null },
                { name: 'ä¸å¹³è¡¡B', attrs: { pow: 60, hit: 120, eye: 80 }, targets: null }
            ];
            
            let resultHTML = `
                <div class="results-container">
                    <h3>â†”ï¸ é›™å‘è½‰æ›æ¸¬è©¦çµæœ</h3>
                    <p>æ¸¬è©¦ å±¬æ€§â†’çµ±è¨ˆâ†’å±¬æ€§ çš„è½‰æ›ä¸€è‡´æ€§</p>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>æ¸¬è©¦æ¡ˆä¾‹</th>
                                <th>åŸå§‹å±¬æ€§</th>
                                <th>æ¨¡æ“¬çµ±è¨ˆ</th>
                                <th>è½‰æ›èª¤å·®</th>
                                <th>è½‰æ›ç‹€æ…‹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            testCases.forEach(testCase => {
                // ç¬¬ä¸€æ­¥ï¼šå±¬æ€§ â†’ çµ±è¨ˆ
                const stats = simulatePlayerStats(testCase.attrs.pow, testCase.attrs.hit, testCase.attrs.eye, 50, 600);
                
                // ç¬¬äºŒæ­¥ï¼šçµ±è¨ˆ â†’ å±¬æ€§ (ç°¡åŒ–ç‰ˆï¼Œå¯¦éš›éœ€è¦å®Œæ•´çš„é€†å‘å·¥ç¨‹)
                // é€™è£¡ç”¨ç°¡åŒ–çš„æ–¹å¼ä¼°ç®—è½‰æ›èª¤å·®
                let conversionError = 'N/A';
                let conversionStatus = 'å¾…å¯¦ç¾';
                let conversionColor = 'var(--warning)';
                
                if (testCase.targets) {
                    const baError = Math.abs(stats.BA - testCase.targets.BA);
                    const obpError = Math.abs(stats.OBP - testCase.targets.OBP);
                    const slgError = Math.abs(stats.SLG - testCase.targets.SLG);
                    const avgError = (baError + obpError + slgError) / 3;
                    
                    conversionError = (avgError * 100).toFixed(2) + '%';
                    
                    if (avgError < 0.01) { conversionStatus = 'å„ªç§€'; conversionColor = 'var(--success)'; }
                    else if (avgError < 0.02) { conversionStatus = 'è‰¯å¥½'; conversionColor = 'var(--info)'; }
                    else if (avgError < 0.05) { conversionStatus = 'å¯æ¥å—'; conversionColor = 'var(--warning)'; }
                    else { conversionStatus = 'éœ€æ”¹é€²'; conversionColor = 'var(--error)'; }
                }
                
                resultHTML += `
                    <tr>
                        <td><strong>${testCase.name}</strong></td>
                        <td>${testCase.attrs.pow}/${testCase.attrs.hit}/${testCase.attrs.eye}</td>
                        <td>${stats.BA.toFixed(3)}/${stats.OBP.toFixed(3)}/${stats.SLG.toFixed(3)}</td>
                        <td>${conversionError}</td>
                        <td><span style="color: ${conversionColor}; font-weight: bold;">${conversionStatus}</span></td>
                    </tr>
                `;
            });
            
            resultHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>è½‰æ›èªªæ˜:</strong> å®Œæ•´çš„é›™å‘è½‰æ›éœ€è¦é€†å‘å·¥ç¨‹åŠŸèƒ½ã€‚ç›®å‰é¡¯ç¤ºçš„æ˜¯æ­£å‘è½‰æ›æº–ç¢ºæ€§ã€‚
                        è½‰æ›èª¤å·® &lt;1% ç‚ºå„ªç§€ï¼Œ&lt;2% ç‚ºè‰¯å¥½ï¼Œ&lt;5% ç‚ºå¯æ¥å—ã€‚
                    </div>
                </div>
            `;
            
            return resultHTML;
        }
        
        function runAllPlayersTest() {
            showLoadingResults('comparisonResults', 'æ­£åœ¨åˆ†ææ‰€æœ‰çƒå“¡...');
            setTimeout(() => {
                const results = performAllPlayersTest();
                displayResults('comparisonResults', results);
            }, 2000);
        }
        
        function performAllPlayersTest() {
            const players = [
                { name: 'Aaron Judge 2024', BA: 0.322, OBP: 0.458, SLG: 0.701, HR: 58 },
                { name: 'Shohei Ohtani 2024', BA: 0.310, OBP: 0.390, SLG: 0.646, HR: 54 },
                { name: 'Juan Soto 2024', BA: 0.288, OBP: 0.419, SLG: 0.569, HR: 41 },
                { name: 'Mookie Betts 2024', BA: 0.289, OBP: 0.372, SLG: 0.491, HR: 19 },
                { name: 'Bobby Witt Jr. 2024', BA: 0.332, OBP: 0.389, SLG: 0.588, HR: 32 }
            ];
            
            let resultHTML = `
                <div class="results-container">
                    <h3>ğŸ† å…¨å“¡å°æ¯”æ¸¬è©¦çµæœ</h3>
                    <table class="results-table">
                        <thead>
                            <tr>
                                <th>çƒå“¡</th>
                                <th>çœŸå¯¦ BA/OBP/SLG</th>
                                <th>çœŸå¯¦ HR</th>
                                <th>é ä¼°å±¬æ€§</th>
                                <th>é ä¼°æº–ç¢ºåº¦</th>
                                <th>çƒå“¡é¡å‹</th>
                            </tr>
                        </thead>
                        <tbody>
            `;
            
            players.forEach(player => {
                // ç°¡åŒ–çš„å±¬æ€§ä¼°ç®—ï¼ˆå¯¦éš›éœ€è¦å®Œæ•´é€†å‘å·¥ç¨‹ï¼‰
                const estimatedPow = Math.round(50 + (player.SLG - 0.400) * 100);
                const estimatedHit = Math.round(50 + (player.BA - 0.250) * 200);
                const estimatedEye = Math.round(50 + (player.OBP - player.BA - 0.050) * 300);
                
                // é™åˆ¶ç¯„åœ
                const pow = Math.max(40, Math.min(150, estimatedPow));
                const hit = Math.max(40, Math.min(150, estimatedHit));
                const eye = Math.max(40, Math.min(150, estimatedEye));
                
                // è¨ˆç®—çƒå“¡é¡å‹
                let playerType = '';
                if (player.HR >= 50) playerType = 'è¶…ç´šå¼·æ‰“è€…';
                else if (player.HR >= 35) playerType = 'å¼·æ‰“è€…';
                else if (player.BA >= 0.320) playerType = 'é«˜æ‰“æ“Šç‡å‹';
                else if (player.OBP >= 0.400) playerType = 'ä¸Šå£˜ç‡å‹';
                else playerType = 'å¹³è¡¡å‹';
                
                // ç°¡åŒ–æº–ç¢ºåº¦è©•ä¼°
                const powerAccuracy = Math.max(0, 100 - Math.abs(player.SLG - 0.500) * 200);
                const accuracy = Math.min(95, powerAccuracy);
                
                let accuracyColor = '';
                if (accuracy >= 90) accuracyColor = 'var(--success)';
                else if (accuracy >= 80) accuracyColor = 'var(--info)';
                else if (accuracy >= 70) accuracyColor = 'var(--warning)';
                else accuracyColor = 'var(--error)';
                
                resultHTML += `
                    <tr>
                        <td><strong>${player.name}</strong></td>
                        <td>${player.BA}/${player.OBP}/${player.SLG}</td>
                        <td><strong>${player.HR}</strong></td>
                        <td>${pow}/${hit}/${eye}</td>
                        <td><span style="color: ${accuracyColor}; font-weight: bold;">${accuracy.toFixed(0)}%</span></td>
                        <td>${playerType}</td>
                    </tr>
                `;
            });
            
            resultHTML += `
                        </tbody>
                    </table>
                    <div style="margin-top: 16px; padding: 16px; background: var(--accent-light); border-radius: var(--radius-md);">
                        <strong>å°æ¯”æ‘˜è¦:</strong> é ä¼°å±¬æ€§åŸºæ–¼ç°¡åŒ–å…¬å¼è¨ˆç®—ï¼Œå®Œæ•´åŠŸèƒ½éœ€è¦é€†å‘å·¥ç¨‹æ¨¡çµ„ã€‚
                        çƒå“¡é¡å‹å¹«åŠ©ç†è§£ä¸åŒæ‰“æ“Šé¢¨æ ¼çš„å±¬æ€§ç‰¹å¾µåˆ†å¸ƒã€‚
                    </div>
                </div>
            `;
            
            return resultHTML;
        }
        
        // ================================== 
        // å°èˆªå’Œä¸»é¡ŒåŠŸèƒ½
        // ==================================
        function goToMainPage() {
            window.location.href = '../index.html';
        }
        
        // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½ (å¾ä¸»é é¢è¤‡è£½)
        function toggleTheme() {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'light';
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            
            document.documentElement.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            
            const themeButton = document.getElementById('themeToggle');
            themeButton.textContent = newTheme === 'light' ? 'â—' : 'â—‘';
            themeButton.title = newTheme === 'light' ? 'åˆ‡æ›æ·±æ·ºæ¨¡å¼' : 'åˆ‡æ›æ·±æ·ºæ¨¡å¼';
        }
        
        // è¼‰å…¥ä¿å­˜çš„ä¸»é¡Œ
        function loadSavedTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeButton = document.getElementById('themeToggle');
            if (themeButton) {
                themeButton.textContent = savedTheme === 'light' ? 'â—' : 'â—‘';
                themeButton.title = 'åˆ‡æ›æ·±æ·ºæ¨¡å¼';
            }
        }
        
        // ================================== 
        // åˆå§‹åŒ–
        // ==================================
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ”¬ Research Mode - Modern Edition Loaded');
            
            // è¼‰å…¥ä¸»é¡Œè¨­å®š
            loadSavedTheme();
            
            // è‡ªå‹•é‹è¡Œæ ¸å¿ƒæ¸¬è©¦
            setTimeout(runEssentialTest, 500);
        });
    </script>
</body>
</html>