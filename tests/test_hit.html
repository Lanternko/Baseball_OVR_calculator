<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HIT Model Test</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #2c3e50; 
            color: white; 
            padding: 20px; 
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { 
            text-align: center; 
            color: #3498db;
            margin-bottom: 30px;
        }
        .test-button { 
            background: linear-gradient(135deg, #27ae60, #2ecc71); 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(39, 174, 96, 0.4);
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            background: #34495e;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td { 
            padding: 12px; 
            text-align: center; 
            border-bottom: 1px solid #555;
        }
        th { 
            background: #1a252f;
            font-weight: 600;
            color: #3498db;
        }
        td {
            font-family: 'Courier New', monospace;
        }
        tr:hover {
            background: #3e5570;
        }
        .benchmark-highlight {
            background: #f39c12 !important;
            font-weight: bold;
        }
        .summary {
            background: #1a252f;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .summary h3 {
            color: #27ae60;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š HIT æ¨¡å‹åˆ†æå·¥å…·</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <button class="test-button" onclick="runHITTest()">ğŸ¯ åŸ·è¡Œ HIT åˆ†æ</button>
            <button class="test-button" onclick="runBenchmarkTest()">ğŸ“‹ åŸºæº–é»æ¸¬è©¦</button>
        </div>
        
        <div class="summary">
            <h3>ğŸ¯ æ¸¬è©¦é…ç½®</h3>
            <p><strong>å›ºå®šåƒæ•¸</strong>: POW=70, EYE=70 (è¯ç›Ÿå¹³å‡)</p>
            <p><strong>è®Šå‹•åƒæ•¸</strong>: HIT 40-150 (æ¯10é»)</p>
            <p><strong>ç›®æ¨™é©—è­‰</strong>: HIT 40/70/100 æ˜¯å¦å‘½ä¸­åŸºæº– BA 0.210/0.250/0.320</p>
        </div>
        
        <div id="results">
            <p style="text-align: center; color: #7f8c8d;">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
        </div>
    </div>

    <script src="constants.js"></script>
    <script src="probability_model.js"></script>
    <script src="simulation_engine.js"></script>

    <script>
        function runHITTest() {
            console.log('ğŸ¯ Testing HIT Model Analysis');
            console.log('Fixed POW=70, EYE=70, varying HIT 40-150');
            
            const results = [];
            const benchmarks = {'40': 0.210, '70': 0.250, '100': 0.320};
            
            for (let hit = 40; hit <= 150; hit += 5) {
                const stats = simulatePlayerStats(70, hit, 70, 100, 600);
                const babip = stats.BABIP || 0;
                const kRate = (stats.K_rate * 100).toFixed(1);
                const hitCount = Math.round(stats.H_count || 0);
                
                results.push({
                    HIT: hit,
                    BA: stats.BA.toFixed(3),
                    BABIP: babip.toFixed(3),
                    'K%': kRate + '%',
                    'å®‰æ‰“æ•¸': hitCount,
                    'ä¸‰æŒ¯æ•¸': Math.round(stats.K_count || 0),
                    isBenchmark: benchmarks.hasOwnProperty(hit.toString())
                });
            }
            
            console.table(results);
            
            // Display results in HTML
            let html = `
                <div class="summary">
                    <h3>ğŸ“ˆ HIT æ¨¡å‹åˆ†æçµæœ</h3>
                    <p><strong>æ¸¬è©¦å®Œæˆ</strong>: HIT 40-150 å®Œæ•´åˆ†æ</p>
                    <p><strong>é—œéµç™¼ç¾</strong>: æª¢æŸ¥åŸºæº–é»æ˜¯å¦å°é½Š MLB åˆ†ä½ˆè¦æ±‚</p>
                </div>
                
                <table>
                    <tr>
                        <th>HIT</th>
                        <th>BA</th>
                        <th>BABIP</th>
                        <th>ä¸‰æŒ¯ç‡</th>
                        <th>å®‰æ‰“æ•¸</th>
                        <th>ä¸‰æŒ¯æ•¸</th>
                        <th>åŸºæº–æª¢æŸ¥</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const benchmark = benchmarks[row.HIT];
                const benchmarkStatus = benchmark ? 
                    `ç›®æ¨™: ${benchmark.toFixed(3)}` : '-';
                const deviation = benchmark ? 
                    (Math.abs(parseFloat(row.BA) - benchmark) * 1000).toFixed(1) : '-';
                const rowClass = row.isBenchmark ? 'benchmark-highlight' : '';
                
                html += `
                    <tr class="${rowClass}">
                        <td><strong>${row.HIT}</strong></td>
                        <td><strong>${row.BA}</strong></td>
                        <td>${row.BABIP}</td>
                        <td>${row['K%']}</td>
                        <td>${row['å®‰æ‰“æ•¸']}</td>
                        <td>${row['ä¸‰æŒ¯æ•¸']}</td>
                        <td>${benchmarkStatus}${deviation !== '-' ? `<br>èª¤å·®: ${deviation}` : ''}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            // Add benchmark summary
            html += '<div class="summary">';
            html += '<h3>ğŸ¯ åŸºæº–é»é”æˆæª¢æŸ¥</h3>';
            Object.entries(benchmarks).forEach(([hit, target]) => {
                const result = results.find(r => r.HIT == hit);
                if (result) {
                    const actual = parseFloat(result.BA);
                    const error = Math.abs(actual - target);
                    const status = error < 0.010 ? 'âœ… å„ªç§€' : error < 0.020 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€æ”¹å–„';
                    html += `<p><strong>HIT ${hit}</strong>: ç›®æ¨™ ${target.toFixed(3)}, å¯¦éš› ${actual.toFixed(3)}, èª¤å·® ${error.toFixed(3)} ${status}</p>`;
                }
            });
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
        }
        
        function runBenchmarkTest() {
            console.log('ğŸ“‹ Running HIT Benchmark Validation');
            
            const benchmarkTests = [
                {hit: 40, target: 0.210, desc: 'PR1 åŸºæº–'},
                {hit: 70, target: 0.250, desc: 'PR50 åŸºæº–'},
                {hit: 100, target: 0.320, desc: 'PR99 åŸºæº–'}
            ];
            
            const results = [];
            
            benchmarkTests.forEach(test => {
                const stats = simulatePlayerStats(70, test.hit, 70, 200, 600);
                const error = Math.abs(stats.BA - test.target);
                const status = error < 0.010 ? 'âœ… å„ªç§€' : error < 0.020 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€æ”¹å–„';
                
                results.push({
                    æè¿°: test.desc,
                    HIT: test.hit,
                    ç›®æ¨™BA: test.target.toFixed(3),
                    å¯¦éš›BA: stats.BA.toFixed(3),
                    èª¤å·®: error.toFixed(3),
                    ç‹€æ…‹: status
                });
            });
            
            let html = `
                <div class="summary">
                    <h3>ğŸ“‹ HIT åŸºæº–é»é©—è­‰çµæœ</h3>
                    <p><strong>æ¸¬è©¦ç›®çš„</strong>: é©—è­‰ HIT å±¬æ€§æ˜¯å¦æ­£ç¢ºå°æ‡‰ MLB BA åˆ†ä½ˆåŸºæº–</p>
                </div>
                
                <table>
                    <tr>
                        <th>åŸºæº–æè¿°</th>
                        <th>HITå€¼</th>
                        <th>ç›®æ¨™BA</th>
                        <th>å¯¦éš›BA</th>
                        <th>èª¤å·®</th>
                        <th>è©•ä¼°</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const rowClass = row.ç‹€æ…‹.includes('å„ªç§€') ? 'benchmark-highlight' : '';
                html += `
                    <tr class="${rowClass}">
                        <td>${row.æè¿°}</td>
                        <td><strong>${row.HIT}</strong></td>
                        <td>${row.ç›®æ¨™BA}</td>
                        <td><strong>${row.å¯¦éš›BA}</strong></td>
                        <td>${row.èª¤å·®}</td>
                        <td>${row.ç‹€æ…‹}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            const allGood = results.every(r => r.ç‹€æ…‹.includes('å„ªç§€') || r.ç‹€æ…‹.includes('è‰¯å¥½'));
            html += `
                <div class="summary">
                    <h3>ğŸ“Š æ•´é«”è©•ä¼°</h3>
                    <p><strong>ç³»çµ±ç‹€æ…‹</strong>: ${allGood ? 'ğŸ¯ HIT åŸºæº–é»æ ¡æº–è‰¯å¥½' : 'âš ï¸ éœ€è¦èª¿æ•´ HIT éŒ¨é»'}</p>
                    <p><strong>å»ºè­°</strong>: ${allGood ? 'å¯ä»¥é€²è¡Œä¸‹ä¸€æ­¥æ¸¬è©¦' : 'è«‹èª¿æ•´ BABIP_S_CURVE_HIT_ANCHORS åƒæ•¸'}</p>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>