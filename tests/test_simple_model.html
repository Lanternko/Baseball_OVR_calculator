<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡åŒ–æ¨¡å‹æ¸¬è©¦</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f7fa;
        }
        .test-section {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-result {
            font-family: 'Courier New', monospace;
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            font-size: 13px;
            line-height: 1.4;
        }
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .comparison-table th,
        .comparison-table td {
            padding: 8px 12px;
            border: 1px solid #ddd;
            text-align: center;
        }
        .comparison-table th {
            background: #e9ecef;
            font-weight: 600;
        }
        .better {
            background: #d4edda;
            font-weight: bold;
        }
        .worse {
            background: #f8d7da;
        }
        .button {
            background: linear-gradient(45deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: transform 0.2s;
        }
        .button:hover {
            transform: translateY(-2px);
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ ç°¡åŒ–æ¨¡å‹ vs å››è±¡é™æ¨¡å‹å°æ¯”æ¸¬è©¦</h1>
    
    <div class="test-section">
        <h2>ğŸš€ å¿«é€Ÿæ¸¬è©¦</h2>
        <button class="button" onclick="runBasicTest()">åŸºç¤åŠŸèƒ½æ¸¬è©¦</button>
        <button class="button" onclick="runEffectTests()">é—œéµæ•ˆæœé©—è­‰</button>
        <button class="button" onclick="runModelComparison()">æ¨¡å‹å°æ¯”æ¸¬è©¦</button>
        <button class="button" onclick="runTargetTest()">ç›®æ¨™å€¼æ¸¬è©¦</button>
    </div>
    
    <div class="test-section">
        <h2>ğŸ“Š æ¸¬è©¦çµæœ</h2>
        <div id="test-results">
            <p>é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
        </div>
    </div>
    
    <!-- è¼‰å…¥å¿…è¦çš„è…³æœ¬ -->
    <script src="../src/js/constants.js"></script>
    <script src="../src/js/ovr_calculator.js"></script>
    <script src="../src/js/probability_model.js"></script>
    <script src="../src/js/simulation_engine.js"></script>
    <script src="../src/js/simple_model.js"></script>
    
    <script>
        // æ¸¬è©¦çµæœé¡¯ç¤ºå‡½æ•¸
        function showResult(title, content) {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML += `
                <h3>${title}</h3>
                <div class="test-result">${content}</div>
            `;
        }
        
        // åŸºç¤åŠŸèƒ½æ¸¬è©¦
        function runBasicTest() {
            const resultsDiv = document.getElementById('test-results');
            resultsDiv.innerHTML = '<h3>ğŸ§ª åŸºç¤åŠŸèƒ½æ¸¬è©¦</h3>';
            
            console.log('ğŸ§ª é–‹å§‹åŸºç¤åŠŸèƒ½æ¸¬è©¦...');
            
            // æ¸¬è©¦æ¨™æº–é…ç½®
            const testConfig = { POW: 100, HIT: 100, EYE: 100, pa: 600 };
            
            try {
                // æ¸¬è©¦ç°¡åŒ–æ¨¡å‹
                const simpleStats = simulatePlayerStatsSimple(
                    testConfig.POW, testConfig.HIT, testConfig.EYE, 1000, testConfig.pa
                );
                
                let result = `âœ… ç°¡åŒ–æ¨¡å‹åŸºç¤æ¸¬è©¦é€šé\n`;
                result += `é…ç½®: POW=${testConfig.POW}, HIT=${testConfig.HIT}, EYE=${testConfig.EYE}\n`;
                result += `çµæœ: BA=${simpleStats.BA.toFixed(3)}, OBP=${simpleStats.OBP.toFixed(3)}, SLG=${simpleStats.SLG.toFixed(3)}\n`;
                result += `     HR=${simpleStats.HR}, 2B=${simpleStats['2B']}, BB=${simpleStats.BB}\n`;
                
                showResult('åŸºç¤åŠŸèƒ½æ¸¬è©¦', result);
                
            } catch (error) {
                showResult('åŸºç¤åŠŸèƒ½æ¸¬è©¦', `âŒ æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }
        
        // é—œéµæ•ˆæœé©—è­‰
        function runEffectTests() {
            console.log('ğŸ§ª é–‹å§‹é—œéµæ•ˆæœé©—è­‰...');
            
            let allResults = '';
            
            // 1. HITå¢åŠ  â†’ HRå¢åŠ æ¸¬è©¦
            allResults += 'ğŸ“ˆ æ¸¬è©¦ HITâ†‘ â†’ HRâ†‘ (HRæ˜¯å®‰æ‰“å­é›†)\n';
            allResults += 'å›ºå®š POW=100, EYE=100\n\n';
            
            const hitLevels = [40, 70, 100, 130];
            const hitResults = [];
            
            hitLevels.forEach(hit => {
                const stats = simulatePlayerStatsSimple(100, hit, 100, 1000, 600);
                hitResults.push({
                    hit: hit,
                    ba: stats.BA,
                    hr: stats.HR,
                    hits: stats.H
                });
                allResults += `HIT ${hit}: BA=${stats.BA.toFixed(3)}, HR=${stats.HR}, ç¸½å®‰æ‰“=${stats.H}\n`;
            });
            
            // æª¢æŸ¥æ˜¯å¦HITå¢åŠ æ™‚HRä¹Ÿå¢åŠ 
            let hitToHrCheck = true;
            for (let i = 1; i < hitResults.length; i++) {
                if (hitResults[i].hr < hitResults[i-1].hr) {
                    hitToHrCheck = false;
                    break;
                }
            }
            allResults += hitToHrCheck ? 'âœ… HITâ†‘ â†’ HRâ†‘ æ•ˆæœç¢ºèª\n\n' : 'âŒ HITâ†‘ â†’ HRâ†‘ æ•ˆæœå¤±æ•ˆ\n\n';
            
            // 2. EYEå¢åŠ  â†’ BAå°å¹…å¢åŠ æ¸¬è©¦
            allResults += 'ğŸ‘ï¸ æ¸¬è©¦ EYEâ†‘ â†’ BAå°å¹…â†‘\n';
            allResults += 'å›ºå®š POW=100, HIT=100\n\n';
            
            const eyeLevels = [40, 70, 100, 130];
            const eyeResults = [];
            
            eyeLevels.forEach(eye => {
                const stats = simulatePlayerStatsSimple(100, 100, eye, 1000, 600);
                eyeResults.push({
                    eye: eye,
                    ba: stats.BA,
                    obp: stats.OBP,
                    bb: stats.BB
                });
                allResults += `EYE ${eye}: BA=${stats.BA.toFixed(3)}, OBP=${stats.OBP.toFixed(3)}, BB=${stats.BB}\n`;
            });
            
            // æª¢æŸ¥EYEå¢åŠ æ™‚BAæ˜¯å¦æœ‰å°å¹…æå‡
            let eyeToBACheck = true;
            for (let i = 1; i < eyeResults.length; i++) {
                if (eyeResults[i].ba <= eyeResults[i-1].ba) {
                    eyeToBACheck = false;
                    break;
                }
            }
            allResults += eyeToBACheck ? 'âœ… EYEâ†‘ â†’ BAå°å¹…â†‘ æ•ˆæœç¢ºèª\n\n' : 'âŒ EYEâ†‘ â†’ BAå°å¹…â†‘ æ•ˆæœå¤±æ•ˆ\n\n';
            
            // 3. POWå¢åŠ  â†’ HRå¤§å¹…å¢åŠ æ¸¬è©¦
            allResults += 'ğŸ’¥ æ¸¬è©¦ POWâ†‘ â†’ HRå¤§å¹…â†‘\n';
            allResults += 'å›ºå®š HIT=100, EYE=100\n\n';
            
            const powLevels = [40, 70, 100, 130];
            const powResults = [];
            
            powLevels.forEach(pow => {
                const stats = simulatePlayerStatsSimple(pow, 100, 100, 1000, 600);
                const xbh = stats.HR + stats['2B'];
                powResults.push({
                    pow: pow,
                    slg: stats.SLG,
                    hr: stats.HR,
                    xbh: xbh
                });
                allResults += `POW ${pow}: SLG=${stats.SLG.toFixed(3)}, HR=${stats.HR}, XBH=${xbh}\n`;
            });
            
            // æª¢æŸ¥POWå¢åŠ æ™‚HRæ˜¯å¦å¤§å¹…å¢åŠ 
            let powToHRCheck = true;
            for (let i = 1; i < powResults.length; i++) {
                if (powResults[i].hr <= powResults[i-1].hr) {
                    powToHRCheck = false;
                    break;
                }
            }
            allResults += powToHRCheck ? 'âœ… POWâ†‘ â†’ HRå¤§å¹…â†‘ æ•ˆæœç¢ºèª\n' : 'âŒ POWâ†‘ â†’ HRå¤§å¹…â†‘ æ•ˆæœå¤±æ•ˆ\n';
            
            showResult('é—œéµæ•ˆæœé©—è­‰', allResults);
        }
        
        // æ¨¡å‹å°æ¯”æ¸¬è©¦
        function runModelComparison() {
            console.log('ğŸ§ª é–‹å§‹æ¨¡å‹å°æ¯”æ¸¬è©¦...');
            
            const testCases = [
                { name: 'Level 40', pow: 40, hit: 40, eye: 40 },
                { name: 'Level 70', pow: 70, hit: 70, eye: 70 },
                { name: 'Level 100', pow: 100, hit: 100, eye: 100 },
                { name: 'é«˜POWçµ„åˆ', pow: 130, hit: 80, eye: 80 },
                { name: 'é«˜HITçµ„åˆ', pow: 80, hit: 130, eye: 80 },
                { name: 'é«˜EYEçµ„åˆ', pow: 80, hit: 80, eye: 130 }
            ];
            
            let comparisonHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>æ¸¬è©¦çµ„åˆ</th>
                            <th>æ¨¡å‹</th>
                            <th>BA</th>
                            <th>OBP</th>
                            <th>SLG</th>
                            <th>HR</th>
                            <th>2B</th>
                            <th>BB</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            testCases.forEach(testCase => {
                try {
                    // èˆŠæ¨¡å‹
                    const oldStats = simulatePlayerStats(testCase.pow, testCase.hit, testCase.eye, 100, 600);
                    
                    // æ–°æ¨¡å‹
                    const newStats = simulatePlayerStatsSimple(testCase.pow, testCase.hit, testCase.eye, 1000, 600);
                    
                    comparisonHTML += `
                        <tr>
                            <td rowspan="2">${testCase.name}<br>(${testCase.pow}/${testCase.hit}/${testCase.eye})</td>
                            <td>å››è±¡é™</td>
                            <td>${oldStats.BA.toFixed(3)}</td>
                            <td>${oldStats.OBP.toFixed(3)}</td>
                            <td>${oldStats.SLG.toFixed(3)}</td>
                            <td>${Math.round(oldStats.HR_count)}</td>
                            <td>${Math.round(oldStats.doubles_count)}</td>
                            <td>${Math.round(oldStats.BB_rate * 600)}</td>
                        </tr>
                        <tr>
                            <td>ç°¡åŒ–</td>
                            <td>${newStats.BA.toFixed(3)}</td>
                            <td>${newStats.OBP.toFixed(3)}</td>
                            <td>${newStats.SLG.toFixed(3)}</td>
                            <td>${newStats.HR}</td>
                            <td>${newStats['2B']}</td>
                            <td>${newStats.BB}</td>
                        </tr>
                    `;
                } catch (error) {
                    comparisonHTML += `
                        <tr>
                            <td colspan="8">âŒ ${testCase.name} æ¸¬è©¦å¤±æ•—: ${error.message}</td>
                        </tr>
                    `;
                }
            });
            
            comparisonHTML += `
                    </tbody>
                </table>
            `;
            
            showResult('æ¨¡å‹å°æ¯”æ¸¬è©¦', comparisonHTML);
        }
        
        // ç›®æ¨™å€¼æ¸¬è©¦
        function runTargetTest() {
            console.log('ğŸ§ª é–‹å§‹ç›®æ¨™å€¼æ¸¬è©¦...');
            
            const targets = [
                { level: 40, pow: 40, hit: 40, eye: 40, targetBA: 0.225, targetOBP: 0.264, targetSLG: 0.313 },
                { level: 70, pow: 70, hit: 70, eye: 70, targetBA: 0.284, targetOBP: 0.347, targetSLG: 0.464 },
                { level: 100, pow: 100, hit: 100, eye: 100, targetBA: 0.343, targetOBP: 0.455, targetSLG: 0.625 }
            ];
            
            let targetHTML = `
                <table class="comparison-table">
                    <thead>
                        <tr>
                            <th>Level</th>
                            <th>çµ±è¨ˆ</th>
                            <th>ç›®æ¨™å€¼</th>
                            <th>ç°¡åŒ–æ¨¡å‹</th>
                            <th>èª¤å·®</th>
                            <th>ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
            `;
            
            targets.forEach(target => {
                const stats = simulatePlayerStatsSimple(target.pow, target.hit, target.eye, 2000, 600);
                
                const baError = Math.abs(stats.BA - target.targetBA);
                const obpError = Math.abs(stats.OBP - target.targetOBP);
                const slgError = Math.abs(stats.SLG - target.targetSLG);
                
                const baStatus = baError < 0.020 ? 'âœ…' : baError < 0.050 ? 'âš ï¸' : 'âŒ';
                const obpStatus = obpError < 0.020 ? 'âœ…' : obpError < 0.050 ? 'âš ï¸' : 'âŒ';
                const slgStatus = slgError < 0.050 ? 'âœ…' : slgError < 0.100 ? 'âš ï¸' : 'âŒ';
                
                targetHTML += `
                    <tr>
                        <td rowspan="3">Level ${target.level}</td>
                        <td>BA</td>
                        <td>${target.targetBA.toFixed(3)}</td>
                        <td>${stats.BA.toFixed(3)}</td>
                        <td>${baError.toFixed(3)}</td>
                        <td>${baStatus}</td>
                    </tr>
                    <tr>
                        <td>OBP</td>
                        <td>${target.targetOBP.toFixed(3)}</td>
                        <td>${stats.OBP.toFixed(3)}</td>
                        <td>${obpError.toFixed(3)}</td>
                        <td>${obpStatus}</td>
                    </tr>
                    <tr>
                        <td>SLG</td>
                        <td>${target.targetSLG.toFixed(3)}</td>
                        <td>${stats.SLG.toFixed(3)}</td>
                        <td>${slgError.toFixed(3)}</td>
                        <td>${slgStatus}</td>
                    </tr>
                `;
            });
            
            targetHTML += `
                    </tbody>
                </table>
                <p><strong>ç‹€æ…‹èªªæ˜:</strong> âœ… å„ªç§€(<2%), âš ï¸ å¯æ¥å—(2-5%), âŒ éœ€èª¿æ•´(>5%)</p>
            `;
            
            showResult('ç›®æ¨™å€¼æ¸¬è©¦', targetHTML);
        }
        
        // é é¢åŠ è¼‰å®Œæˆ
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª ç°¡åŒ–æ¨¡å‹æ¸¬è©¦é é¢å·²è¼‰å…¥');
        });
    </script>
</body>
</html>