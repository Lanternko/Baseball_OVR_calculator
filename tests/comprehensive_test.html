<!DOCTYPE html>
<html>
<head>
    <title>Comprehensive Model Test</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; background: #f8f9fa; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 30px; border-radius: 12px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #e0e0e0; border-radius: 8px; }
        .result-table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 14px; }
        .result-table th, .result-table td { padding: 8px 12px; border: 1px solid #ddd; text-align: center; }
        .result-table th { background: #f8f9fa; font-weight: 600; }
        .pass { color: #27ae60; font-weight: bold; }
        .fail { color: #e74c3c; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 5px; }
        .status-pass { background: #27ae60; }
        .status-fail { background: #e74c3c; }
        .status-warning { background: #f39c12; }
        h1 { color: #2c3e50; text-align: center; margin-bottom: 30px; }
        h2 { color: #34495e; border-bottom: 2px solid #ecf0f1; padding-bottom: 10px; }
        .summary { background: linear-gradient(45deg, #667eea, #764ba2); color: white; padding: 20px; border-radius: 8px; text-align: center; margin-bottom: 30px; }
        button { background: #3498db; color: white; border: none; padding: 10px 20px; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #2980b9; }
        .progress { width: 100%; background: #ecf0f1; border-radius: 10px; margin: 10px 0; }
        .progress-bar { height: 20px; background: linear-gradient(45deg, #667eea, #764ba2); border-radius: 10px; transition: width 0.3s; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”¬ ç¶œåˆæ¨¡å‹æ¸¬è©¦å ±å‘Š</h1>
        
        <div class="summary">
            <h3>æ¸¬è©¦ç‹€æ…‹</h3>
            <div id="overall-status">æº–å‚™é–‹å§‹æ¸¬è©¦...</div>
            <div class="progress">
                <div id="progress-bar" class="progress-bar" style="width: 0%"></div>
            </div>
        </div>
        
        <button onclick="runAllTests()">ğŸš€ é–‹å§‹å®Œæ•´æ¸¬è©¦</button>
        <button onclick="runQuickTest()">âš¡ å¿«é€Ÿæ¸¬è©¦</button>
        <button onclick="runPrecisionTest()">ğŸ¯ ç²¾ç¢ºåº¦æ¸¬è©¦</button>
        
        <div id="test-results"></div>
    </div>
    
    <script src="constants.js"></script>
    <script src="probability_model.js"></script>
    <script src="simulation_engine.js"></script>
    
    <script>
        let testResults = {
            total: 0,
            passed: 0,
            failed: 0,
            warnings: 0
        };
        
        function updateProgress(percentage, message) {
            document.getElementById('progress-bar').style.width = percentage + '%';
            document.getElementById('overall-status').innerHTML = message;
        }
        
        function addTestSection(title, results) {
            const container = document.getElementById('test-results');
            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `
                <h2>${title}</h2>
                <table class="result-table">
                    <thead>
                        <tr>
                            <th>æ¸¬è©¦é …ç›®</th>
                            <th>ç›®æ¨™å€¼</th>
                            <th>å¯¦éš›å€¼</th>
                            <th>èª¤å·®</th>
                            <th>ç‹€æ…‹</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${results.map(r => `
                            <tr>
                                <td>${r.test}</td>
                                <td>${r.expected}</td>
                                <td>${r.actual}</td>
                                <td>${r.error}</td>
                                <td>
                                    <span class="status-indicator status-${r.status}"></span>
                                    <span class="${r.status}">${r.statusText}</span>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            container.appendChild(section);
        }
        
        function testCombination(pow, hit, eye, label) {
            const results = simulatePlayerStats(pow, hit, eye, 50, 600);
            return {
                label: label,
                pow: pow,
                hit: hit, 
                eye: eye,
                BA: results.BA,
                OBP: results.OBP,
                SLG: results.SLG,
                HR: results.HR_count,
                doubles: results.doubles_count,
                XBH: results.HR_count + results.doubles_count,
                hrXbhRatio: results.HR_count / (results.HR_count + results.doubles_count)
            };
        }
        
        function evaluateResult(expected, actual, tolerance = 0.015) {
            const error = Math.abs(expected - actual);
            if (error <= tolerance * 0.5) {
                testResults.passed++;
                return { status: 'pass', statusText: 'é€šé', error: error.toFixed(3) };
            } else if (error <= tolerance) {
                testResults.warnings++;
                return { status: 'warning', statusText: 'è­¦å‘Š', error: error.toFixed(3) };
            } else {
                testResults.failed++;
                return { status: 'fail', statusText: 'å¤±æ•—', error: error.toFixed(3) };
            }
        }
        
        async function runAllTests() {
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('test-results').innerHTML = '';
            
            updateProgress(10, 'é–‹å§‹åŸºæº–æ¸¬è©¦...');
            
            // Test 1: Core Benchmarks (100/100/100)
            const elite = testCombination(100, 100, 100, 'Elite 100/100/100');
            const benchmarkTests = [
                { test: 'BA (æ‰“æ“Šç‡)', expected: 0.320, actual: elite.BA, ...evaluateResult(0.320, elite.BA) },
                { test: 'OBP (ä¸Šå£˜ç‡)', expected: 0.420, actual: elite.OBP.toFixed(3), ...evaluateResult(0.420, elite.OBP) },
                { test: 'SLG (é•·æ‰“ç‡)', expected: 0.570, actual: elite.SLG.toFixed(3), ...evaluateResult(0.570, elite.SLG) }
            ];
            testResults.total += 3;
            addTestSection('ğŸ¯ åŸºæº–æ¸¬è©¦ (100/100/100)', benchmarkTests);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            updateProgress(30, 'æ¸¬è©¦XBHæ¨¡å‹...');
            
            // Test 2: XBH Model
            const xbhTests = [
                { test: 'Total XBH', expected: '75-80', actual: elite.XBH.toFixed(0), error: 'N/A', status: elite.XBH >= 75 && elite.XBH <= 80 ? 'pass' : 'warning', statusText: elite.XBH >= 75 && elite.XBH <= 80 ? 'é€šé' : 'è­¦å‘Š' },
                { test: 'HR/XBH Ratio', expected: '0.53', actual: elite.hrXbhRatio.toFixed(3), ...evaluateResult(0.53, elite.hrXbhRatio, 0.05) },
                { test: 'HR Count', expected: '40-45', actual: elite.HR.toFixed(0), error: 'N/A', status: elite.HR >= 40 && elite.HR <= 45 ? 'pass' : 'warning', statusText: elite.HR >= 40 && elite.HR <= 45 ? 'é€šé' : 'è­¦å‘Š' }
            ];
            testResults.total += 3;
            addTestSection('ğŸ’ª XBH æ¨¡å‹æ¸¬è©¦', xbhTests);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            updateProgress(50, 'æ¸¬è©¦å±¬æ€§éš”é›¢...');
            
            // Test 3: Attribute Isolation  
            const pow70 = testCombination(70, 99, 99, 'POW 70');
            const pow100 = testCombination(100, 99, 99, 'POW 100'); 
            const pow120 = testCombination(120, 99, 99, 'POW 120');
            
            const isolationTests = [
                { test: 'POW 70 SLG', expected: '0.470-0.520', actual: pow70.SLG.toFixed(3), error: 'N/A', status: pow70.SLG >= 0.470 && pow70.SLG <= 0.520 ? 'pass' : 'warning', statusText: pow70.SLG >= 0.470 && pow70.SLG <= 0.520 ? 'é€šé' : 'è­¦å‘Š' },
                { test: 'POW 100 SLG', expected: '0.570', actual: pow100.SLG.toFixed(3), ...evaluateResult(0.570, pow100.SLG, 0.020) },
                { test: 'POW 120 SLG', expected: '0.650-0.700', actual: pow120.SLG.toFixed(3), error: 'N/A', status: pow120.SLG >= 0.650 && pow120.SLG <= 0.700 ? 'pass' : 'warning', statusText: pow120.SLG >= 0.650 && pow120.SLG <= 0.700 ? 'é€šé' : 'è­¦å‘Š' }
            ];
            testResults.total += 3;
            addTestSection('ğŸ”— å±¬æ€§éš”é›¢æ¸¬è©¦', isolationTests);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            updateProgress(70, 'æ¸¬è©¦æ¥µç«¯æ•¸å€¼...');
            
            // Test 4: Extreme Values
            const extreme150 = testCombination(150, 150, 150, 'Extreme 150');
            const extremeTests = [
                { test: 'BAä¸Šé™', expected: '<0.400', actual: extreme150.BA.toFixed(3), error: 'N/A', status: extreme150.BA < 0.400 ? 'pass' : 'fail', statusText: extreme150.BA < 0.400 ? 'é€šé' : 'å¤±æ•—' },
                { test: 'SLGä¸Šé™', expected: '<0.950', actual: extreme150.SLG.toFixed(3), error: 'N/A', status: extreme150.SLG < 0.950 ? 'pass' : 'warning', statusText: extreme150.SLG < 0.950 ? 'é€šé' : 'è­¦å‘Š' },
                { test: 'HRåˆç†æ€§', expected: '<80', actual: extreme150.HR.toFixed(0), error: 'N/A', status: extreme150.HR < 80 ? 'pass' : 'warning', statusText: extreme150.HR < 80 ? 'é€šé' : 'è­¦å‘Š' }
            ];
            testResults.total += 3;
            addTestSection('ğŸš€ æ¥µç«¯æ•¸å€¼æ¸¬è©¦', extremeTests);
            
            await new Promise(resolve => setTimeout(resolve, 500));
            updateProgress(90, 'æ¸¬è©¦åŸºç¤ç©©å®šæ€§...');
            
            // Test 5: Foundation Stability
            const league = testCombination(70, 70, 70, 'League Average');
            const foundationTests = [
                { test: 'League BA', expected: '0.250', actual: league.BA.toFixed(3), ...evaluateResult(0.250, league.BA, 0.020) },
                { test: 'League OBP', expected: '0.320', actual: league.OBP.toFixed(3), ...evaluateResult(0.320, league.OBP, 0.025) },
                { test: 'League SLG', expected: '0.420', actual: league.SLG.toFixed(3), ...evaluateResult(0.420, league.SLG, 0.030) }
            ];
            testResults.total += 3;
            addTestSection('âš–ï¸ åŸºç¤ç©©å®šæ€§æ¸¬è©¦', foundationTests);
            
            updateProgress(100, 'æ¸¬è©¦å®Œæˆ!');
            
            // Final Summary
            const passRate = (testResults.passed / testResults.total * 100).toFixed(1);
            const statusColor = passRate >= 80 ? '#27ae60' : passRate >= 60 ? '#f39c12' : '#e74c3c';
            
            document.getElementById('overall-status').innerHTML = `
                <div style="color: ${statusColor};">
                    <strong>æ¸¬è©¦å®Œæˆ!</strong><br>
                    é€šé: ${testResults.passed}/${testResults.total} (${passRate}%)<br>
                    è­¦å‘Š: ${testResults.warnings} | å¤±æ•—: ${testResults.failed}
                </div>
            `;
        }
        
        async function runQuickTest() {
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('test-results').innerHTML = '';
            
            updateProgress(25, 'å¿«é€Ÿæ¸¬è©¦ä¸­...');
            
            const elite = testCombination(100, 100, 100, 'Quick 100/100/100');
            const quickTests = [
                { test: 'BA', expected: 0.320, actual: elite.BA, ...evaluateResult(0.320, elite.BA) },
                { test: 'OBP', expected: 0.420, actual: elite.OBP.toFixed(3), ...evaluateResult(0.420, elite.OBP) },
                { test: 'SLG', expected: 0.570, actual: elite.SLG.toFixed(3), ...evaluateResult(0.570, elite.SLG) }
            ];
            testResults.total += 3;
            
            updateProgress(100, 'å¿«é€Ÿæ¸¬è©¦å®Œæˆ');
            addTestSection('âš¡ å¿«é€Ÿç²¾ç¢ºåº¦æ¸¬è©¦', quickTests);
        }
        
        async function runPrecisionTest() {
            testResults = { total: 0, passed: 0, failed: 0, warnings: 0 };
            document.getElementById('test-results').innerHTML = '';
            
            updateProgress(50, 'ç²¾ç¢ºåº¦æ¸¬è©¦ä¸­...');
            
            // Run multiple iterations for more precision
            let totalBA = 0, totalOBP = 0, totalSLG = 0;
            const iterations = 10;
            
            for (let i = 0; i < iterations; i++) {
                const result = simulatePlayerStats(100, 100, 100, 100, 600);
                totalBA += result.BA;
                totalOBP += result.OBP; 
                totalSLG += result.SLG;
            }
            
            const avgBA = totalBA / iterations;
            const avgOBP = totalOBP / iterations;
            const avgSLG = totalSLG / iterations;
            
            const precisionTests = [
                { test: 'Precision BA', expected: 0.320, actual: avgBA.toFixed(4), ...evaluateResult(0.320, avgBA, 0.010) },
                { test: 'Precision OBP', expected: 0.420, actual: avgOBP.toFixed(4), ...evaluateResult(0.420, avgOBP, 0.010) },
                { test: 'Precision SLG', expected: 0.570, actual: avgSLG.toFixed(4), ...evaluateResult(0.570, avgSLG, 0.010) }
            ];
            testResults.total += 3;
            
            updateProgress(100, 'ç²¾ç¢ºåº¦æ¸¬è©¦å®Œæˆ');
            addTestSection('ğŸ¯ é«˜ç²¾ç¢ºåº¦æ¸¬è©¦ (10æ¬¡å¹³å‡)', precisionTests);
        }
        
        console.log('ğŸ”¬ Comprehensive Test Suite Loaded');
    </script>
</body>
</html>