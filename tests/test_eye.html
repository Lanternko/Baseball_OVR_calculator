<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>EYE Model Test</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #2c3e50; 
            color: white; 
            padding: 20px; 
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 { 
            text-align: center; 
            color: #9b59b6;
            margin-bottom: 30px;
        }
        .test-button { 
            background: linear-gradient(135deg, #8e44ad, #9b59b6); 
            color: white; 
            padding: 15px 30px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            font-size: 16px;
            font-weight: 600;
            margin: 10px;
            transition: all 0.3s ease;
        }
        .test-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(155, 89, 182, 0.4);
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 20px 0; 
            background: #34495e;
            border-radius: 8px;
            overflow: hidden;
        }
        th, td { 
            padding: 12px; 
            text-align: center; 
            border-bottom: 1px solid #555;
        }
        th { 
            background: #1a252f;
            font-weight: 600;
            color: #9b59b6;
        }
        td {
            font-family: 'Courier New', monospace;
        }
        tr:hover {
            background: #3e5570;
        }
        .benchmark-highlight {
            background: #e74c3c !important;
            font-weight: bold;
        }
        .summary {
            background: #1a252f;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .summary h3 {
            color: #9b59b6;
            margin-top: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ‘ï¸ EYE æ¨¡å‹åˆ†æå·¥å…·</h1>
        
        <div style="text-align: center; margin-bottom: 30px;">
            <button class="test-button" onclick="runEYETest()">ğŸ¯ åŸ·è¡Œ EYE åˆ†æ</button>
            <button class="test-button" onclick="runBenchmarkTest()">ğŸ“‹ åŸºæº–é»æ¸¬è©¦</button>
        </div>
        
        <div class="summary">
            <h3>ğŸ‘ï¸ æ¸¬è©¦é…ç½®</h3>
            <p><strong>å›ºå®šåƒæ•¸</strong>: POW=70, HIT=70 (è¯ç›Ÿå¹³å‡)</p>
            <p><strong>è®Šå‹•åƒæ•¸</strong>: EYE 40-150 (æ¯10é»)</p>
            <p><strong>ç›®æ¨™é©—è­‰</strong>: EYE 40/70/100 æ˜¯å¦å‘½ä¸­åŸºæº– OBP 0.280/0.320/0.420</p>
        </div>
        
        <div id="results">
            <p style="text-align: center; color: #7f8c8d;">é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
        </div>
    </div>

    <script src="constants.js"></script>
    <script src="probability_model.js"></script>
    <script src="simulation_engine.js"></script>

    <script>
        function runEYETest() {
            console.log('ğŸ‘ï¸ Testing EYE Model Analysis');
            console.log('Fixed POW=70, HIT=70, varying EYE 40-150');
            
            const results = [];
            const benchmarks = {'40': 0.280, '70': 0.320, '100': 0.420};
            
            for (let eye = 40; eye <= 150; eye += 5) {
                const stats = simulatePlayerStats(70, 70, eye, 100, 600);
                const bbRate = (stats.BB_rate * 100).toFixed(1);
                const kRate = (stats.K_rate * 100).toFixed(1);
                const bbCount = Math.round(stats.BB_count || 0);
                const kCount = Math.round(stats.K_count || 0);
                
                results.push({
                    EYE: eye,
                    OBP: stats.OBP.toFixed(3),
                    'BB%': bbRate + '%',
                    'K%': kRate + '%',
                    'ä¿é€æ•¸': bbCount,
                    'ä¸‰æŒ¯æ•¸': kCount,
                    'BB/K': bbCount > 0 && kCount > 0 ? (bbCount/kCount).toFixed(2) : '0.00',
                    isBenchmark: benchmarks.hasOwnProperty(eye.toString())
                });
            }
            
            console.table(results);
            
            // Display results in HTML
            let html = `
                <div class="summary">
                    <h3>ğŸ“ˆ EYE æ¨¡å‹åˆ†æçµæœ</h3>
                    <p><strong>æ¸¬è©¦å®Œæˆ</strong>: EYE 40-150 å®Œæ•´åˆ†æ</p>
                    <p><strong>é—œéµç™¼ç¾</strong>: æª¢æŸ¥åŸºæº–é»æ˜¯å¦å°é½Š MLB åˆ†ä½ˆè¦æ±‚</p>
                </div>
                
                <table>
                    <tr>
                        <th>EYE</th>
                        <th>OBP</th>
                        <th>ä¿é€ç‡</th>
                        <th>ä¸‰æŒ¯ç‡</th>
                        <th>ä¿é€æ•¸</th>
                        <th>ä¸‰æŒ¯æ•¸</th>
                        <th>BB/Kæ¯”</th>
                        <th>åŸºæº–æª¢æŸ¥</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const benchmark = benchmarks[row.EYE];
                const benchmarkStatus = benchmark ? 
                    `ç›®æ¨™: ${benchmark.toFixed(3)}` : '-';
                const deviation = benchmark ? 
                    (Math.abs(parseFloat(row.OBP) - benchmark) * 1000).toFixed(1) : '-';
                const rowClass = row.isBenchmark ? 'benchmark-highlight' : '';
                
                html += `
                    <tr class="${rowClass}">
                        <td><strong>${row.EYE}</strong></td>
                        <td><strong>${row.OBP}</strong></td>
                        <td>${row['BB%']}</td>
                        <td>${row['K%']}</td>
                        <td>${row['ä¿é€æ•¸']}</td>
                        <td>${row['ä¸‰æŒ¯æ•¸']}</td>
                        <td>${row['BB/K']}</td>
                        <td>${benchmarkStatus}${deviation !== '-' ? `<br>èª¤å·®: ${deviation}` : ''}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            // Add benchmark summary
            html += '<div class="summary">';
            html += '<h3>ğŸ¯ åŸºæº–é»é”æˆæª¢æŸ¥</h3>';
            Object.entries(benchmarks).forEach(([eye, target]) => {
                const result = results.find(r => r.EYE == eye);
                if (result) {
                    const actual = parseFloat(result.OBP);
                    const error = Math.abs(actual - target);
                    const status = error < 0.010 ? 'âœ… å„ªç§€' : error < 0.020 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€æ”¹å–„';
                    html += `<p><strong>EYE ${eye}</strong>: ç›®æ¨™ ${target.toFixed(3)}, å¯¦éš› ${actual.toFixed(3)}, èª¤å·® ${error.toFixed(3)} ${status}</p>`;
                }
            });
            html += '</div>';
            
            document.getElementById('results').innerHTML = html;
        }
        
        function runBenchmarkTest() {
            console.log('ğŸ“‹ Running EYE Benchmark Validation');
            
            const benchmarkTests = [
                {eye: 40, target: 0.280, desc: 'PR1 åŸºæº–'},
                {eye: 70, target: 0.320, desc: 'PR50 åŸºæº–'},
                {eye: 100, target: 0.420, desc: 'PR99 åŸºæº–'}
            ];
            
            const results = [];
            
            benchmarkTests.forEach(test => {
                const stats = simulatePlayerStats(70, 70, test.eye, 200, 600);
                const error = Math.abs(stats.OBP - test.target);
                const status = error < 0.010 ? 'âœ… å„ªç§€' : error < 0.020 ? 'âš ï¸ è‰¯å¥½' : 'âŒ éœ€æ”¹å–„';
                
                results.push({
                    æè¿°: test.desc,
                    EYE: test.eye,
                    ç›®æ¨™OBP: test.target.toFixed(3),
                    å¯¦éš›OBP: stats.OBP.toFixed(3),
                    ä¿é€ç‡: (stats.BB_rate * 100).toFixed(1) + '%',
                    ä¸‰æŒ¯ç‡: (stats.K_rate * 100).toFixed(1) + '%',
                    èª¤å·®: error.toFixed(3),
                    ç‹€æ…‹: status
                });
            });
            
            let html = `
                <div class="summary">
                    <h3>ğŸ“‹ EYE åŸºæº–é»é©—è­‰çµæœ</h3>
                    <p><strong>æ¸¬è©¦ç›®çš„</strong>: é©—è­‰ EYE å±¬æ€§æ˜¯å¦æ­£ç¢ºå°æ‡‰ MLB OBP åˆ†ä½ˆåŸºæº–</p>
                </div>
                
                <table>
                    <tr>
                        <th>åŸºæº–æè¿°</th>
                        <th>EYEå€¼</th>
                        <th>ç›®æ¨™OBP</th>
                        <th>å¯¦éš›OBP</th>
                        <th>ä¿é€ç‡</th>
                        <th>ä¸‰æŒ¯ç‡</th>
                        <th>èª¤å·®</th>
                        <th>è©•ä¼°</th>
                    </tr>
            `;
            
            results.forEach(row => {
                const rowClass = row.ç‹€æ…‹.includes('å„ªç§€') ? 'benchmark-highlight' : '';
                html += `
                    <tr class="${rowClass}">
                        <td>${row.æè¿°}</td>
                        <td><strong>${row.EYE}</strong></td>
                        <td>${row.ç›®æ¨™OBP}</td>
                        <td><strong>${row.å¯¦éš›OBP}</strong></td>
                        <td>${row.ä¿é€ç‡}</td>
                        <td>${row.ä¸‰æŒ¯ç‡}</td>
                        <td>${row.èª¤å·®}</td>
                        <td>${row.ç‹€æ…‹}</td>
                    </tr>
                `;
            });
            
            html += '</table>';
            
            const allGood = results.every(r => r.ç‹€æ…‹.includes('å„ªç§€') || r.ç‹€æ…‹.includes('è‰¯å¥½'));
            html += `
                <div class="summary">
                    <h3>ğŸ“Š æ•´é«”è©•ä¼°</h3>
                    <p><strong>ç³»çµ±ç‹€æ…‹</strong>: ${allGood ? 'ğŸ‘ï¸ EYE åŸºæº–é»æ ¡æº–è‰¯å¥½' : 'âš ï¸ éœ€è¦èª¿æ•´ EYE éŒ¨é»'}</p>
                    <p><strong>å»ºè­°</strong>: ${allGood ? 'å¯ä»¥é€²è¡Œä¸‹ä¸€æ­¥æ¸¬è©¦' : 'è«‹èª¿æ•´ BB_S_CURVE_EYE_ANCHORS åƒæ•¸'}</p>
                </div>
            `;
            
            document.getElementById('results').innerHTML = html;
        }
    </script>
</body>
</html>