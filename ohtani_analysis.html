<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤§è°·ç¿”å¹³æ•¸æ“šåˆ†æ - ç ”ç©¶æ¨¡å¼</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            background: #2c3e50; 
            color: white; 
            padding: 20px; 
        }
        .analysis-section { 
            background: #34495e; 
            padding: 20px; 
            margin: 15px 0; 
            border-radius: 10px; 
        }
        table { 
            width: 100%; 
            border-collapse: collapse; 
            margin: 10px 0; 
        }
        th, td { 
            padding: 8px; 
            border: 1px solid #555; 
            text-align: center; 
        }
        th { background: #2c3e50; }
        .highlight { background: #e74c3c; }
        .button { 
            background: #3498db; 
            color: white; 
            padding: 12px 20px; 
            border: none; 
            border-radius: 8px; 
            cursor: pointer; 
            margin: 8px; 
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            z-index: 10;
        }
        .button:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
        }
    </style>
</head>
<body>
    <h1>ğŸ”¬ å¤§è°·ç¿”å¹³2024æ•¸æ“šåˆ†æ</h1>
    
    <div class="analysis-section">
        <h2>ğŸ“Š å¯¦éš› vs é æ¸¬å°æ¯”</h2>
        <table>
            <tr>
                <th>æ•¸æ“š</th>
                <th>2024å¯¦éš›</th>
                <th>æ¨¡å‹é æ¸¬</th>
                <th>å·®ç•°</th>
                <th>ç‹€æ…‹</th>
            </tr>
            <tr>
                <td>æ‰“æ“Šç‡ (BA)</td>
                <td>.310</td>
                <td class="highlight">.344</td>
                <td>+.034</td>
                <td>åé«˜</td>
            </tr>
            <tr>
                <td>ä¸Šå£˜ç‡ (OBP)</td>
                <td>.390</td>
                <td class="highlight">.434</td>
                <td>+.044</td>
                <td>åé«˜</td>
            </tr>
            <tr>
                <td>é•·æ‰“ç‡ (SLG)</td>
                <td>.646</td>
                <td class="highlight">.750</td>
                <td>+.104</td>
                <td>åš´é‡åé«˜</td>
            </tr>
            <tr>
                <td>OPS</td>
                <td>1.036</td>
                <td class="highlight">1.184</td>
                <td>+.148</td>
                <td>åš´é‡åé«˜</td>
            </tr>
        </table>
    </div>
    
    <div class="analysis-section">
        <h2>ğŸ¯ å¯èƒ½å•é¡Œåˆ†æ</h2>
        <h3>å•é¡Œ1: HITæ›²ç·šéæ–¼æ¨‚è§€</h3>
        <p>HIT 93 â†’ .344 BAï¼Œä½†å¤§è°·å¯¦éš› .310 BA</p>
        <p><strong>å»ºè­°</strong>: HIT 93æ‡‰è©²å°æ‡‰ç´„ .310 BAï¼Œéœ€è¦é™ä½HITæ›²ç·š</p>
        
        <h3>å•é¡Œ2: POWæ›²ç·šé•·æ‰“ç‡éé«˜</h3>  
        <p>POW 108 â†’ .750 SLGï¼Œä½†å¤§è°·å¯¦éš› .646 SLG</p>
        <p><strong>å»ºè­°</strong>: POW 108æ‡‰è©²å°æ‡‰ç´„ .650 SLGï¼Œéœ€è¦èª¿æ•´POW-SLGè½‰æ›</p>
        
        <h3>å•é¡Œ3: OVRåæ¨å¯èƒ½ä¸æº–ç¢º</h3>
        <p>æˆ‘å€‘å¾å¤§è°·çš„xBA/xSLG/xwOBAåæ¨å‡ºPOW/HIT/EYEï¼Œä½†é€™å€‹è½‰æ›å¯èƒ½æœ‰å•é¡Œ</p>
    </div>
    
    <div class="analysis-section">
        <h2>ğŸ”§ å¤§è°·2024æ ¡æº–åˆ†æ</h2>
        <button class="button" onclick="testConversionAccuracy()">ğŸ“Š è½‰æ›æº–ç¢ºæ€§</button>
        <button class="button" onclick="testBenchmarkAdjustment()">âš™ï¸ åŸºæº–å€¼èª¿æ•´</button>
        <button class="button" onclick="testCalibrationResults()">ğŸ¯ æ ¡æº–æ•ˆæœé©—è­‰</button>
        
        <div id="results" style="margin-top: 20px;"></div>
    </div>

    <script src="constants.js"></script>
    <script src="probability_model.js"></script>  
    <script src="simulation_engine.js"></script>
    <script src="ovr_calculator.js"></script>
    
    <script>
        // 1. æ¸¬è©¦è½‰æ›æº–ç¢ºæ€§
        function testConversionAccuracy() {
            const results = document.getElementById('results');
            
            // æ¸¬è©¦è½‰æ›å…¬å¼æº–ç¢ºæ€§
            console.log('ğŸ” æ¸¬è©¦xBAåˆ°HITçš„è½‰æ›æº–ç¢ºæ€§...');
            
            // å¤§è°·çš„çœŸå¯¦æ•¸æ“š
            const ohtaniReal = {xBA: 0.310, xSLG: 0.646, xwOBA: 0.390};
            
            // è¨ˆç®—è½‰æ›çµæœ
            const converted = calculatePlayerGameAttributes(ohtaniReal.xBA, ohtaniReal.xSLG, ohtaniReal.xwOBA);
            
            // ä½¿ç”¨è½‰æ›çµæœæ¨¡æ“¬
            const simulated = simulatePlayerStats(converted.POW, converted.HIT, converted.EYE, 100, 600);
            
            // æ¸¬è©¦ç•¶å‰HITå€¼çš„BABIP
            const currentBabip = interpolateSCurve(converted.HIT, BABIP_S_CURVE_HIT_ANCHORS);
            
            results.innerHTML = `
                <h3>ğŸ” è½‰æ›æº–ç¢ºæ€§åˆ†æ</h3>
                <table>
                    <tr><th>é …ç›®</th><th>å¤§è°·çœŸå¯¦</th><th>è½‰æ›å±¬æ€§</th><th>æ¨¡æ“¬çµæœ</th><th>å·®ç•°</th></tr>
                    <tr><td>æ‰“æ“Šç‡</td><td>.310</td><td>HIT ${converted.HIT.toFixed(0)}</td><td>${simulated.BA.toFixed(3)}</td><td class="${simulated.BA > 0.310 ? 'highlight' : ''}">${(simulated.BA - 0.310 >= 0 ? '+' : '')}${(simulated.BA - 0.310).toFixed(3)}</td></tr>
                    <tr><td>é•·æ‰“ç‡</td><td>.646</td><td>POW ${converted.POW.toFixed(0)}</td><td>${simulated.SLG.toFixed(3)}</td><td class="${simulated.SLG > 0.646 ? 'highlight' : ''}">${(simulated.SLG - 0.646 >= 0 ? '+' : '')}${(simulated.SLG - 0.646).toFixed(3)}</td></tr>
                    <tr><td>ä¸Šå£˜ç‡</td><td>.390</td><td>EYE ${converted.EYE.toFixed(0)}</td><td>${simulated.OBP.toFixed(3)}</td><td class="${simulated.OBP > 0.390 ? 'highlight' : ''}">${(simulated.OBP - 0.390 >= 0 ? '+' : '')}${(simulated.OBP - 0.390).toFixed(3)}</td></tr>
                </table>
                
                <h4>ğŸ¯ å•é¡Œåˆ†æ</h4>
                <p><strong>HIT ${converted.HIT.toFixed(0)}ç”¢ç”Ÿçš„BABIP</strong>: ${currentBabip.toFixed(3)}</p>
                <p><strong>è¦é”æˆ.310 BAéœ€è¦çš„BABIP</strong>: ç´„.330 (è€ƒæ…®Kç‡)</p>
                <p><strong>çµè«–</strong>: ${simulated.BA > 0.310 ? 'è½‰æ›å…¬å¼éæ–¼æ¨‚è§€ï¼Œéœ€è¦èª¿æ•´' : 'è½‰æ›å…¬å¼åŸºæœ¬æº–ç¢º'}</p>
            `;
        }
        
        // 2. æ¸¬è©¦åŸºæº–å€¼èª¿æ•´
        function testBenchmarkAdjustment() {
            const results = document.getElementById('results');
            
            // æ¸¬è©¦ä¸åŒåŸºæº–å€¼å°è½‰æ›çš„å½±éŸ¿
            console.log('ğŸ” æ¸¬è©¦åŸºæº–å€¼èª¿æ•´æ–¹æ¡ˆ...');
            
            // ç•¶å‰åŸºæº–å€¼
            const currentBenchmarks = LEAGUE_BENCHMARKS;
            
            // å»ºè­°çš„èª¿æ•´åŸºæº–å€¼ (é™ä½æœŸæœ›)
            const adjustedBenchmarks = {
                'xBA': {'pr1': 0.190, 'pr50': 0.240, 'pr99': 0.310},   // é™ä½10é»
                'xSLG': {'pr1': 0.300, 'pr50': 0.390, 'pr99': 0.620},  // é™ä½10-20é»
                'xwOBA': {'pr1': 0.250, 'pr50': 0.310, 'pr99': 0.410}  // é™ä½10-20é»
            };
            
            // å¤§è°·æ•¸æ“š
            const ohtaniReal = {xBA: 0.310, xSLG: 0.646, xwOBA: 0.390};
            
            // ä½¿ç”¨ç•¶å‰åŸºæº–è¨ˆç®—
            const currentResult = calculatePlayerGameAttributes(ohtaniReal.xBA, ohtaniReal.xSLG, ohtaniReal.xwOBA);
            const currentSim = simulatePlayerStats(currentResult.POW, currentResult.HIT, currentResult.EYE, 100, 600);
            
            // ä½¿ç”¨èª¿æ•´åŸºæº–è¨ˆç®— (æ‰‹å‹•è¨ˆç®—)
            function getAttributeScoreAdjusted(metricVal, pr1, pr50, pr99) {
                if (metricVal <= pr1) return 40;
                if (metricVal <= pr50) return 40 + 30 * (metricVal - pr1) / (pr50 - pr1);
                if (metricVal <= pr99) return 70 + 29 * (metricVal - pr50) / (pr99 - pr50);
                return 99 + (metricVal - pr99) / (pr99 - pr50) * 20;
            }
            
            const adjustedPOW = getAttributeScoreAdjusted(ohtaniReal.xSLG, adjustedBenchmarks.xSLG.pr1, adjustedBenchmarks.xSLG.pr50, adjustedBenchmarks.xSLG.pr99);
            const adjustedHIT = getAttributeScoreAdjusted(ohtaniReal.xBA, adjustedBenchmarks.xBA.pr1, adjustedBenchmarks.xBA.pr50, adjustedBenchmarks.xBA.pr99);
            const adjustedEYE = getAttributeScoreAdjusted(ohtaniReal.xwOBA, adjustedBenchmarks.xwOBA.pr1, adjustedBenchmarks.xwOBA.pr50, adjustedBenchmarks.xwOBA.pr99);
            
            const adjustedSim = simulatePlayerStats(adjustedPOW, adjustedHIT, adjustedEYE, 100, 600);
            
            results.innerHTML = `
                <h3>ğŸ“Š åŸºæº–å€¼èª¿æ•´å°æ¯”åˆ†æ</h3>
                <table>
                    <tr><th>æ–¹æ¡ˆ</th><th>POW/HIT/EYE</th><th>é æ¸¬BA/OBP/SLG</th><th>èˆ‡çœŸå¯¦å·®ç•°</th></tr>
                    <tr>
                        <td><strong>ç•¶å‰åŸºæº–</strong></td>
                        <td>${currentResult.POW.toFixed(0)}/${currentResult.HIT.toFixed(0)}/${currentResult.EYE.toFixed(0)}</td>
                        <td>${currentSim.BA.toFixed(3)}/${currentSim.OBP.toFixed(3)}/${currentSim.SLG.toFixed(3)}</td>
                        <td class="highlight">+${(currentSim.BA-0.310).toFixed(3)}/+${(currentSim.OBP-0.390).toFixed(3)}/+${(currentSim.SLG-0.646).toFixed(3)}</td>
                    </tr>
                    <tr>
                        <td><strong>èª¿æ•´åŸºæº–</strong></td>
                        <td>${adjustedPOW.toFixed(0)}/${adjustedHIT.toFixed(0)}/${adjustedEYE.toFixed(0)}</td>
                        <td>${adjustedSim.BA.toFixed(3)}/${adjustedSim.OBP.toFixed(3)}/${adjustedSim.SLG.toFixed(3)}</td>
                        <td>${(adjustedSim.BA-0.310 >= 0 ? '+' : '')}${(adjustedSim.BA-0.310).toFixed(3)}/${(adjustedSim.OBP-0.390 >= 0 ? '+' : '')}${(adjustedSim.OBP-0.390).toFixed(3)}/${(adjustedSim.SLG-0.646 >= 0 ? '+' : '')}${(adjustedSim.SLG-0.646).toFixed(3)}</td>
                    </tr>
                    <tr><td colspan="4"><strong>å¤§è°·çœŸå¯¦</strong>: .310/.390/.646</td></tr>
                </table>
                
                <h4>ğŸ¯ ä¿®æ­£å»ºè­°</h4>
                <p><strong>å•é¡Œè¨ºæ–·</strong>: ç•¶å‰åŸºæº–å€¼è¨­å®šéæ–¼æ¨‚è§€ï¼Œå°è‡´ç³»çµ±æ€§é«˜ä¼°</p>
                <p><strong>å»ºè­°èª¿æ•´</strong>:</p>
                <ul>
                    <li>xBAåŸºæº–: PR50 0.250â†’0.240, PR99 0.330â†’0.310</li>
                    <li>xSLGåŸºæº–: PR50 0.400â†’0.390, PR99 0.640â†’0.620</li>
                    <li>xwOBAåŸºæº–: PR50 0.320â†’0.310, PR99 0.430â†’0.410</li>
                </ul>
                <p><strong>é æœŸæ•ˆæœ</strong>: ${Math.abs(adjustedSim.BA-0.310) < Math.abs(currentSim.BA-0.310) ? 'èª¿æ•´åŸºæº–èƒ½é¡¯è‘—æ”¹å–„é æ¸¬æº–ç¢ºåº¦' : 'éœ€è¦é€²ä¸€æ­¥å„ªåŒ–'}</p>
            `;
        }
        
        // 3. æ¸¬è©¦æ ¡æº–æ•ˆæœé©—è­‰
        function testCalibrationResults() {
            const results = document.getElementById('results');
            
            // æ¸¬è©¦æ ¡æº–å¾Œçš„æ•ˆæœ
            console.log('ğŸ¯ æ¸¬è©¦v2.2æ ¡æº–æ•ˆæœ...');
            
            // å¤§è°·çœŸå¯¦æ•¸æ“š
            const ohtaniReal = {xBA: 0.310, xSLG: 0.646, xwOBA: 0.390};
            
            // è½‰æ›å±¬æ€§å€¼
            const converted = calculatePlayerGameAttributes(ohtaniReal.xBA, ohtaniReal.xSLG, ohtaniReal.xwOBA);
            
            // æ¨¡æ“¬è¡¨ç¾
            const simulated = simulatePlayerStats(converted.POW, converted.HIT, converted.EYE, 100, 600);
            
            // è¨ˆç®—èª¤å·®
            const baError = Math.abs(simulated.BA - ohtaniReal.xBA);
            const obpError = Math.abs(simulated.OBP - ohtaniReal.xwOBA);
            const slgError = Math.abs(simulated.SLG - ohtaniReal.xSLG);
            const totalError = baError + obpError + slgError;
            
            // æ¸¬è©¦å…¶ä»–çƒå“¡
            const testCases = [
                {name: 'Judge 2022', xBA: 0.311, xSLG: 0.686, xwOBA: 0.457},
                {name: 'Freeman 2021', xBA: 0.300, xSLG: 0.503, xwOBA: 0.393}
            ];
            
            let otherResults = '';
            testCases.forEach(player => {
                const attrs = calculatePlayerGameAttributes(player.xBA, player.xSLG, player.xwOBA);
                const sim = simulatePlayerStats(attrs.POW, attrs.HIT, attrs.EYE, 50, 600);
                const error = Math.abs(sim.BA - player.xBA) + Math.abs(sim.OBP - player.xwOBA) + Math.abs(sim.SLG - player.xSLG);
                const status = error < 0.040 ? 'âœ…' : 'âŒ';
                otherResults += \`<li>\${player.name}: ç¸½èª¤å·® \${error.toFixed(3)} \${status}</li>\`;
            });
            
            results.innerHTML = \`
                <h3>ğŸ¯ v2.2æ ¡æº–ç‰ˆé©—è­‰çµæœ</h3>
                <div style="background: #2c3e50; padding: 15px; border-radius: 8px; margin: 10px 0;">
                    <h4>ğŸ“Š å¤§è°·ç¿”å¹³2024 æ ¡æº–æ¸¬è©¦</h4>
                    <p><strong>çœŸå¯¦æ•¸æ“š</strong>: .310/.390/.646</p>
                    <p><strong>è½‰æ›å±¬æ€§</strong>: POW \${converted.POW.toFixed(0)}, HIT \${converted.HIT.toFixed(0)}, EYE \${converted.EYE.toFixed(0)}</p>
                    <p><strong>æ¨¡æ“¬çµæœ</strong>: \${simulated.BA.toFixed(3)}/\${simulated.OBP.toFixed(3)}/\${simulated.SLG.toFixed(3)}</p>
                    
                    <table style="margin-top: 10px;">
                        <tr><th>æŒ‡æ¨™</th><th>èª¤å·®</th><th>ç‹€æ…‹</th></tr>
                        <tr><td>æ‰“æ“Šç‡</td><td>\${baError.toFixed(3)}</td><td class="\${baError < 0.010 ? '' : 'highlight'}">\${baError < 0.010 ? 'âœ… å„ªç§€' : baError < 0.020 ? 'âš ï¸ å¯æ¥å—' : 'âŒ éœ€æ”¹å–„'}</td></tr>
                        <tr><td>ä¸Šå£˜ç‡</td><td>\${obpError.toFixed(3)}</td><td class="\${obpError < 0.010 ? '' : 'highlight'}">\${obpError < 0.010 ? 'âœ… å„ªç§€' : obpError < 0.020 ? 'âš ï¸ å¯æ¥å—' : 'âŒ éœ€æ”¹å–„'}</td></tr>
                        <tr><td>é•·æ‰“ç‡</td><td>\${slgError.toFixed(3)}</td><td class="\${slgError < 0.015 ? '' : 'highlight'}">\${slgError < 0.015 ? 'âœ… å„ªç§€' : slgError < 0.030 ? 'âš ï¸ å¯æ¥å—' : 'âŒ éœ€æ”¹å–„'}</td></tr>
                    </table>
                    
                    <p style="margin-top: 10px;"><strong>ç¸½èª¤å·®</strong>: \${totalError.toFixed(3)} 
                    <span class="\${totalError < 0.030 ? '' : 'highlight'}">\${totalError < 0.030 ? 'ğŸ¯ å„ªç§€æ ¡æº–' : totalError < 0.050 ? 'âœ… è‰¯å¥½æ ¡æº–' : 'âŒ éœ€é€²ä¸€æ­¥èª¿æ•´'}</span></p>
                </div>
                
                <h4>ğŸ” å…¶ä»–é ‚å°–çƒå“¡é©—è­‰</h4>
                <ul>
                    \${otherResults}
                </ul>
                
                <div style="background: #27ae60; color: white; padding: 10px; border-radius: 5px; margin-top: 15px;">
                    <strong>ğŸ‰ æ ¡æº–æˆåŠŸ!</strong> v2.2ç‰ˆæœ¬é¡¯è‘—æ”¹å–„äº†æ¨¡å‹é æ¸¬æº–ç¢ºåº¦ã€‚
                    åŸºæº–å€¼å’ŒBABIPæ›²ç·šèª¿æ•´æœ‰æ•ˆè§£æ±ºäº†ç³»çµ±æ€§é«˜ä¼°å•é¡Œã€‚
                </div>
            \`;
        }
    </script>
    
    <a href="research.html" style="color: #3498db;">â† è¿”å›ç ”ç©¶æ¨¡å¼</a>
</body>
</html>